<!DOCTYPE html>
<html lang="en">
<head>
    
    <!-- clarity -->
     <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "r4ikpxyih2");
</script>


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Movie & Trailer App</title>
     
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
       :root {
    --primary: #d81b60;
    --primary-dark: #ad1457;
    --glow: rgba(216, 27, 96, 0.5);
    --anime: #e91e63;
    --anime-dark: #c2185b;
    --bg: #0a0a0e;
    --card-bg: linear-gradient(145deg, #1a1a22, #2a2a32);
    --text: #f0f0f0;
    --text-secondary: #b0b0b0;
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            user-select: none;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 60px;
            transition: background 0.3s ease;
        }

        body.light-mode {
            --bg: #f5f5f5;
            --card-bg: linear-gradient(145deg, #ffffff, #e0e0e0);
            --text: #333333;
            --text-secondary: #666666;
            --glow: rgba(138, 43, 226, 0.2);
        }

        .search-container {
       
            height: 60px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 10, 14, 0.85);
            backdrop-filter: blur(12px);
            padding: 10px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            transition: var(--transition);
        }

        body.light-mode .search-container {
            background: rgba(245, 245, 245, 0.85);
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }

        .search-wrapper {
            position: relative;
            width: 100%;
            max-width: 600px;
            display: flex;
            align-items: center;
        }

        .search-container input {
            padding: 12px 20px;
            font-size: 16px;
            width: 100%;
            border: 1px solid transparent;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text);
            text-align: left;
            transition: var(--transition);
            box-shadow: 0 0 10px var(--glow);
        }

        .search-container input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--glow);
            background: rgba(255, 255, 255, 0.12);
        }

        body.light-mode .search-container input {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text);
        }

        .search-container input::placeholder {
            color: var(--text-secondary);
            animation: pulse-placeholder 3s infinite;
        }

        @keyframes pulse-placeholder {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

       /* Search button */
.search-container button {
    padding: 12px 2px;
    font-size: 10px;
    background: transparent;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 30px;
    margin-left: 10px;
    transition: var(--transition);
    box-shadow: 0 0 10px var(--glow);
}

.search-container button:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

/* Carousel nav */
.carousel-nav:hover {
    background: var(--primary);
    box-shadow: 0 0 10px var(--glow);
    
}

/* Favorite button */
.favorite-btn:hover {
    transform: scale(1.2);
    background: rgba(216, 27, 96, 0.3);
}


/* Settings icon */
.settings-icon.account {
    background: var(--primary);
}

        .search-history {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 600px;
            background: rgba(26, 26, 34, 0.95);
            border-radius: 15px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(8px);
        }

        body.light-mode .search-history {
            background: rgba(255, 255, 255, 0.95);
        }

        .search-history-item {
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            transition: var(--transition);
            color: var(--text);
        }

        .search-history-item:hover {
            background: var(--primary);
            color: white;
        }

        .carousel-container {
            width: 100%;
            overflow: hidden;
            position: relative;
            margin: 0 auto 40px;
            padding: 20px 0;
            background: linear-gradient(180deg, rgba(138, 43, 226, 0.1), transparent);
        }

        .carousel-track {
            display: flex;
            gap: 20px;
            padding: 0 20px;
            transition: transform 0.6s ease;
        }

        .carousel-item {
            flex: 0 0 calc(80% - 20px);
            min-width: 0;
            aspect-ratio: 16/9;
            position: relative;
            transform: perspective(1000px) rotateY(0deg);
            transition: var(--transition);
        }

        .carousel-item:hover {
            transform: perspective(1000px) rotateY(5deg) scale(1.02);
        }

        @media (min-width: 768px) {
            .carousel-item {
                flex: 0 0 calc(50% - 20px);
            }
        }

        @media (min-width: 1024px) {
            .carousel-item {
                flex: 0 0 calc(33.33% - 20px);
            }
        }

        .carousel-item .thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .carousel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            color: white;
            opacity: 0;
            transition: var(--transition);
        }

        .carousel-item:hover .carousel-overlay {
            opacity: 1;
        }

        .carousel-overlay h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .carousel-overlay p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            color: white;
            font-size: 24px;
            transition: var(--transition);
        }

        .carousel-nav:hover {
            background: var(--primary);
        }

        .carousel-prev {
            left: 10px;
        }

        .carousel-next {
            right: 10px;
        }

        .content {
            margin-top: 20px;
            padding-bottom: 20px;
        }

        .section-title {
            padding: 15px 20px;
            font-size: 24px;
            font-weight: 800;
            position: relative;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #forYouSection .section-title {
            color: var(--anime);
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 20px;
            width: 50px;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        #forYouSection .section-title::after {
            background: var(--anime);
        }

        .section-title:hover::after {
            width: 100px;
        }

        body.light-mode .section-title {
            color: var(--text);
        }

      .results-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 100%;
}

        .card {
  background: var(--card-bg);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  transition: transform 0.3s, box-shadow 0.3s;
  position: relative;
  border: 1px solid transparent;
  width: 100%;
  max-width: 100%;
}

.card:hover {
  transform: translateY(-5px); /* Reduced effect for larger cards */
  box-shadow: 0 12px 24px var(--glow);
  border: 1px solid var(--primary);
}

        .thumbnail {
  width: 100%;
  height: auto;
  aspect-ratio: 16/9;
  object-fit: cover;
  cursor: pointer;
  transition: transform 0.3s;
}

        .card:hover .thumbnail {
            transform: scale(1.05);
        }

        .card-content {
            padding: 15px;
            background: rgba(0,0,0,0.2);
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        body.light-mode .video-title {
            color: var(--text);
        }

        .channel {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .views-count {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .likes-count {
            background: rgba(255, 50, 50, 0.3);
            padding: 4px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            animation: pulse 1.5s infinite;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            z-index: 2;
        }

        .favorite-btn.active {
            color: #ff4757;
            background: rgba(255, 71, 87, 0.3);
        }

        .favorite-btn:hover {
            transform: scale(1.2);
        }

        .favorite-btn i {
            pointer-events: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            z-index: 1001;
            display: none;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(255, 255, 255, 0.2);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(138, 43, 226, 0.9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            z-index: 1001;
            display: none;
            max-width: 80%;
        }

      /* Me Page Styles */
#mePage {
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
}


.profile-header {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.profile-header {
    position: relative;
    margin: 0 15px 30px;
    padding: 0;
    background: transparent;
    border-radius: 15px;
    overflow: hidden;
    text-align: center;
}

.profile-banner {
    height: 150px;
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    position: relative;
    z-index: 0;
}

.profile-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.2), transparent);
    opacity: 0.5;
    z-index: 1;
}

.profile-avatar-container {
    margin-top: -60px;
    z-index: 2;
}

.profile-avatar {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto;
    cursor: pointer;
    transition: var(--transition);
}

.profile-avatar img {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid var(--card-bg);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    transition: var(--transition);
}

.profile-avatar:hover img {
    transform: scale(1.1);
    box-shadow: 0 0 20px var(--glow);
}

.avatar-glow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    box-shadow: 0 0 15px var(--glow), 0 0 30px var(--glow);
    opacity: 0.7;
    animation: pulse 2s infinite ease-in-out;
    z-index: -1;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 0.7; }
    50% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 0.7; }
}

.profile-header {
    position: relative;
    margin: 0 15px 20px; /* Reduced bottom margin */
    padding: 0;
    background: transparent;
    border-radius: 15px;
    overflow: hidden;
    text-align: center;
}

.profile-header p {
    font-size: 16px;
    color: var(--text-secondary);
    margin: 0;
}

.edit-profile-btn {
    display: block;
    margin: 0 auto;
    padding: 12px 30px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: var(--transition);
    box-shadow: 0 0 10px var(--glow);
}

.edit-profile-btn:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

body.light-mode .profile-header h3 {
    color: #333;
}

body.light-mode .profile-header p {
    color: #666;
}

body.light-mode .profile-stats {
    background: linear-gradient(145deg, #ffffff, #e0e0e0);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

body.light-mode .profile-banner {
    background: linear-gradient(135deg, #e91e63, #ad1457);
}


.profile-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    text-align: center;
    text-transform: capitalize;
    overflow: hidden;
    padding: 5px;
}

.profile-avatar span {
    line-height: 1.2;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.profile-info h3 {
    margin: 0;
    font-size: 18px;
    color: var(--text-color);
}

.profile-info p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.me-content {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.stat-card {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.stat-card i {
    font-size: 24px;
    color: var(--primary);
    margin-bottom: 10px;
}

.stat-card h4 {
    margin: 0;
    font-size: 16px;
    color: var(--text-color);
}

.stat-card p {
    margin: 5px 0 0;
    font-size: 14px;
    color: var(--text-secondary);
}

.settings-grid {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.settings-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 15px;
    background: var(--card-bg);
    border-radius: 10px;
    cursor: pointer;
    transition: background 0.3s;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.settings-item:hover {
    background: var(--hover-bg);
}

.settings-item i:first-child {
    font-size: 20px;
    color: var(--primary);
    margin-right: 10px;
}

.settings-item span {
    flex: 1;
    font-size: 16px;
    color: var(--text-color);
}
video
.settings-item i:last-child {
    font-size: 16px;
    color: var(--text-secondary);
}

/* Modal Styles (for Account and Notification Modals) */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: var(--card-bg);
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    width: 90%;
    position: relative;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.modal-content .close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 20px;
    cursor: pointer;
    color: var(--text-secondary);
}

.modal-content .close:hover {
    color: var(--primary);
}

.modal-content h3 {
    margin: 0 0 15px;
    font-size: 18px;
    color: var(--text-color);
}

.modal-input {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background: var(--input-bg);
    color: var(--text-color);
    font-size: 14px;
}

.modal-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.modal-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.modal-btn.primary {
    background: var(--primary);
    color: white;
}

.modal-btn.secondary {
    background: var(--secondary);
    color: var(--text-color);
}

.modal-btn:hover {
    opacity: 0.9;
}


#accountModal .modal-content {
    padding: 20px;
    text-align: center;
}

#accountModal form {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#accountModal button {
    padding: 10px;
    margin: 5px;
    width: 100px;
    align-self: center;
}
/* Theme Variables (ensure these are defined) */
body.light-mode {
    --primary: #6200ea;
    --secondary: #e0e0e0;
    --card-bg: #ffffff;
    --text-color: #212121;
    --text-secondary: #757575;
    --border-color: #e0e0e0;
    --input-bg: #f5f5f5;
    --hover-bg: #f0f0f0;
}
.dark-mode {
    --primary: #d81b60;
    --primary-dark: #ad1457;
    --glow: rgba(216, 27, 96, 0.5);
    --card-bg: #424242;
    --text-color: #ffffff;
    --text-secondary: #b0b0b0;
    --border-color: #616161;
    --input-bg: #616161;
    --hover-bg: #616161;
}

        .theme-switcher {
            display: flex;
            gap: 12px;
            margin-top: 12px;
        }

        .theme-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: var(--transition);
        }

        .theme-btn.dark {
            background: #333;
            color: white;
        }

        .theme-btn.light {
            background: #f0f0f0;
            color: #333;
        }

        .theme-btn.active {
            outline: 2px solid var(--primary);
        }

          .bottom-nav {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 400px;
      background: rgba(0, 0, 0, 0.85);
      display: flex;
      justify-content: space-around;
      padding: 10px 5px;
      z-index: 1000;
      border-radius: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.light-mode .bottom-nav {
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 12px;
      transition: all 0.3s;
      padding: 8px 12px;
      border-radius: 20px;
      position: relative;
    }

    .nav-item i {
      font-size: 18px;
      margin-bottom: 3px;
      transition: all 0.3s;
    }

    .nav-item.active {
      color: var(--primary);
      background: rgba(138, 43, 226, 0.2);
    }

    .nav-item:hover:not(.active) {
      color: var(--text);
      background: rgba(255, 255, 255, 0.1);
    }

    body.light-mode .nav-item:hover:not(.active) {
      background: rgba(0, 0, 0, 0.05);
    }

    .nav-item.active::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 5px;
      height: 5px;
      background: var(--primary);
      border-radius: 50%;
    }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--primary);
            opacity: 0.6;
        }

        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }

        .toast.show {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .search-container input {
                width: 100%;
                font-size: 14px;
                padding: 10px 15px;
            }

            .search-container button {
                font-size: 14px;
                padding: 10px 15px;
            }

            .thumbnail {
                height: 180px;
            }

            .video-title {
                font-size: 14px;
            }

            .channel {
                font-size: 12px;
            }

            .pagination button {
                padding: 8px 15px;
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .search-container {
                padding: 8px;
            }

            .thumbnail {
                height: 160px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
        }

        .modal-content {
            background: var(--card-bg);
            max-width: 400px;
            margin: 20vh auto;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-input, .modal-input select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            color: var(--text);
            transition: var(--transition);
        }

        body.light-mode .modal-input, body.light-mode .modal-input select {
            background: rgba(0,0,0,0.05);
            border-color: rgba(0,0,0,0.1);
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-btn.primary {
            background: var(--primary);
            color: white;
        }

        .modal-btn.secondary {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        #mePage ~ .pagination-container {
            display: none !important;
        }

        .notification-list {
            text-align: left;
            margin-top: 20px;
            padding-left: 25px;
            color: var(--text-secondary);
        }

        .notification-list li {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.6;
        }

        .profile-header {
            position: relative;
            margin-bottom: 60px;
        }

        .profile-banner {
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 0 0 15px 15px;
        }

        .profile-avatar-container {
            text-align: center;
            margin-top: -50px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--card-bg);
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            border: 3px solid var(--card-bg);
        }

        .profile-avatar i {
            font-size: 40px;
            color: var(--primary);
        }

        .profile-stats {
            display: flex;
            justify-content: space-around;
            padding: 20px;
            background: var(--card-bg);
            margin: 0 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 0 20px;
        }

        .settings-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            transition: var(--transition);
            cursor: pointer;
            text-align: center;
        }

        .settings-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }

        .settings-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
        }

        .settings-icon.account {
            background: var(--primary);
        }

        .settings-icon.appearance {
            background: #6a1b9a;
        }

        .settings-icon.notifications {
            background: #e91e63;
        }

        .settings-icon.about {
            background: #2196F3;
        }

        .settings-card h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .settings-card p {
            font-size: 12px;
            color: var(--text-secondary);
        }

        @media (max-width: 480px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }
            .profile-banner {
                height: 100px;
            }
        }

    
.premium-modal {
    background: linear-gradient(145deg, #2a2a32, #1a1a22);
    border: 2px solid var(--primary);
    box-shadow: 0 10px 30px rgba(138, 43, 226, 0.5);
    padding: 30px;
    border-radius: 20px;
    animation: fadeInPremium 0.5s ease;
}

.premium-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.app-name {
    font-size: 28px;
    font-weight: 800;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 0 10px var(--glow);
}

.premium-badge {
    background: var(--primary);
    color: white;
    padding: 5px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    animation: pulse 1.5s infinite;
}

.premium-blurb {
    font-size: 16px;
    line-height: 1.6;
    color: var(--text);
    text-align: center;
    margin-bottom: 20px;
}

.app-version {
    text-align: center;
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 400;
}

body.light-mode .premium-modal {
    background: linear-gradient(145deg, #ffffff, #e0e0e0);
    border: 2px solid var(--primary);
}

body.light-mode .premium-blurb {
    color: var(--text);
}

body.light-mode .app-version {
    color: var(--text-secondary);
}

@keyframes fadeInPremium {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}


.auth-cta {
    text-align: center;
    margin-bottom: 20px;
}

.auth-cta h3 {
    font-size: 22px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 8px;
}

//For the sigin and login modal CTA<div></div>
.auth-cta p {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
}

body.light-mode .auth-cta h3 {
    color: var(--primary);
}

body.light-mode .auth-cta p {
    color: var(--text-secondary);
}




.ad-label {
    position: absolute;
    bottom: 8px;
    right: 8px;
    font-size: 10px;
    font-weight: 600;
    color: #ff6666; /* Light red */
    background: rgba(0, 0, 0, 0.5); /* Semi-transparent background for readability */
    padding: 2px 6px;
    border-radius: 3px;
    text-transform: uppercase;
}

.card-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
}

.adsterra-banner {
    width: 100%;
    max-width: 300px;
    min-height: 250px;
    margin: 20px auto;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    border: 1px solid var(--primary); /* #d81b60 */
}

.adsterra-banner iframe {
    width: 100%;
    height: 100%;
    border: none;
}

@media (max-width: 768px) {
    .adsterra-banner {
        max-width: 100%;
        height: auto;
        aspect-ratio: 300 / 250;
    }
    .ad-label {
        font-size: 8px;
        padding: 1px 4px;
        bottom: 6px;
        right: 6px;
    }
}



//Cards Responsive for the home
@media (max-width: 767px) {
  .results-container {
    grid-template-columns: repeat(1, 1fr); /* Full width per card */
    gap: 16px;
    padding: 12px;
  }

  .thumbnail {
    height: 160px;
  }

  .video-title {
    font-size: 14px;
  }

  .channel {
    font-size: 12px;
  }

  .card-content {
    padding: 10px;
  }

  .card {
    border-radius: 10px;
  }
}


/* Mute Button */
.mute-toggle {
  position: absolute;
  bottom: 12px;
  right: 12px;
  background: rgba(0, 0, 0, 0.6);
  border: none;
  color: white;
  padding: 8px;
  border-radius: 50%;
  font-size: 18px;
  cursor: pointer;
  z-index: 2;
  transition: background 0.3s ease;
}

.mute-toggle:hover {
  background: rgba(0, 0, 0, 0.8);
}

/* 435px and below */
@media (max-width: 435px) {
  .video-ad-wrapper {
    width: 95%;
    aspect-ratio: 16/ 9;
  }

  .mute-toggle {
    bottom: 10px;
    right: 10px;
    padding: 7px;
    font-size: 16px;
  }
}

/* 375px and below */
@media (max-width: 375px) {
  .video-ad-wrapper {
    width: 96%;
    aspect-ratio: 16 / 9;
  }

  .mute-toggle {
    bottom: 8px;
    right: 8px;
    padding: 6px;
    font-size: 14px;
  }
}

/* 320px and below */
@media (max-width: 320px) {
  .video-ad-wrapper {
    width: 98%;
    aspect-ratio: 16 / 9;
  }

  .mute-toggle {
    bottom: 6px;
    right: 6px;
    padding: 5px;
    font-size: 13px;
  }
}

/* Tablet and phablet (768px and below) */
@media (max-width: 768px) {
  .video-ad-wrapper {
    max-width: 95%;
  }
}
/* Optional: smaller button on mobile */
@media (max-width: 480px) {
  .mute-toggle {
    font-size: 16px;
    padding: 6px;
    bottom: 8px;
    right: 8px;
  }
}

/* This seems to reset all responsive screens size to fit I wonder how long ot last 
*/
  @media (max-width: 450px) {
  .results-container {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 0 8px;
    box-sizing: border-box;
    width: 100%;
    margin: 0 auto;
  }

  .card {
    width: 100%;
    max-width: 100%;
    border-radius: 10px;
    overflow: hidden;
    background: var(--card-bg);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
  }

  .thumbnail {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    object-fit: cover;
    display: block;
  }

  .card-content {
    padding: 10px;
  }

  .video-title {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
    line-height: 1.3;
  }

  .channel {
    font-size: 12px;
    color: var(--text-secondary);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .card-stats {
    font-size: 11px;
    margin-top: 6px;
    display: flex;
    justify-content: space-between;
  }
}

  /* Global overflow safety */
  html, body {
    overflow-x: hidden;
    width: 100%;
  }
  
 

//Make the courusel move down abit
#exploreCarousel {
  margin-top: 50px; /* or try padding-top if you prefer */
}
@media (max-width: 768px) {
  #exploreCarousel {
    margin-top: 60px;
  }
}

.retry-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 8px 16000px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
}

.retry-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

.retry-btn i {
    margin-right: 5px;
}

        /* Native Ad Styles for guy */
.native-ad-section {
    width: 100%;
    max-width: 900px;
    margin: 25px auto;
    padding: 0 15px;
}

.native-ad-card {
    background: var(--card-bg);
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    border: 1px solid rgba(216, 27, 96, 0.2);
    transition: var(--transition);
}

.native-ad-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px var(--glow);
    border-color: var(--primary);
}

.ad-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    background: linear-gradient(90deg, rgba(216,27,96,0.1) 0%, rgba(138,43,226,0.1) 100%);
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.sponsored-badge {
    background: var(--primary);
    color: white;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ad-header i {
    color: var(--primary);
    opacity: 0.7;
}

.ad-content {
    padding: 15px;
    min-height: 250px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.03);
}

.ad-content iframe {
    width: 100%;
    min-height: 250px;
    border: none;
    border-radius: 8px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .native-ad-card {
        border-radius: 10px;
    }
    
    .ad-content {
        min-height: 200px;
        padding: 10px;
    }
    
    .sponsored-badge {
        font-size: 10px;
        padding: 3px 8px;
    }
}

@media (max-width: 480px) {
    .ad-content {
        min-height: 150px;
    }
    
    .native-ad-section {
        padding: 0 10px;
    }
}

/* Player Styles */
.fixed-player {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 230px;
  background: var(--bg);
  z-index: 1000;
}

.player-wrapper iframe {
  width: 100%;
  height: 100%;
  border: none;
  display: block;
}

.scrollable-content {
  margin-top: 230px;
  padding: 15px;
  box-sizing: border-box;
  width: 100%;
  max-width: 100%;
}

#ytplayer {
  width: 100%;
  height: auto;
  aspect-ratio: 16 / 9;
  display: block;
  border: none;
}

/* Video Info Styles */
.video-info-container {
  width: 100%;
  max-width: 900px;
  padding: 15px;
  box-sizing: border-box;
}

.video-title {
  font-size: 1.25rem;
  font-weight: 500;
  color: var(--text);
  margin: 10px 0 5px 0;
}

.video-stats {
  display: flex;
  align-items: center;
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-bottom: 15px;
}

.video-stats span {
  margin-right: 10px;
}

.video-actions {
  display: flex;
  justify-content: space-around;
  margin: 15px 0;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 15px;
}

.action-button {
  display: flex;
  flex-direction: column;
  align-items: center;
  color: var(--text-secondary);
  background: none;
  border: none;
  cursor: pointer;
  font-size: 0.75rem;
  transition: color 0.3s;
}

.action-button i {
  font-size: 1.5rem;
  margin-bottom: 5px;
}

.action-button.like {
  color: var(--primary);
}

.action-button:hover {
  color: var(--text);
}

.action-button.dislike {
  color: var(--primary);
}

/* Channel Info Styles */
.channel-info {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 0;
  border-bottom: 1px solid var(--border-color);
}

.channel-details {
  display: flex;
  align-items: center;
}

.channel-avatar {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  margin-right: 15px;
  object-fit: cover;
}

.channel-name {
  font-weight: 500;
  color: var(--text);
  margin-bottom: 3px;
}

.channel-subs {
  font-size: 0.75rem;
  color: var(--text-secondary);
}

.yt-subscribed {
  display: inline-block;
  background-color: #c00;          /* YouTube red */
  color: white;
  font-size: 14px;
  font-weight: 500;
  padding: 6px 16px;
  border-radius: 18px;
  box-shadow: 0 1px 2px rgba(0,0,0,0.2);
  font-family: Roboto, Arial, sans-serif;
  line-height: 1;
}

/* Related Videos Styles */
.related-videos {
  width: 100%;
  max-width: 900px;
  padding: 15px;
  box-sizing: border-box;
}

.related-title {
  font-size: 1.125rem;
  font-weight: 500;
  color: var(--text);
  margin-bottom: 15px;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 15px;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .fixed-player {
    height: 200px;
  }

  .player-wrapper iframe {
    height: 100%;
    width: 100%;
  }

  .scrollable-content {
    margin-top: 200px;
    padding: 12px;
  }

  .video-info-container {
    padding: 12px;
    font-size: 14px;
  }

  .video-title {
    font-size: 16px;
    line-height: 1.4;
  }
}

  
 #backToExplore {
  position: fixed;
  top: 0px;
  left: 0px;
  z-index: 9999;
  cursor: pointer;
  background: none;
  border: none;
  padding: 0;
  opacity: 1;
  transition: opacity 0.5s ease; /* âœ… enables fade in/out */
}

#backToExplore svg {
  width: 72px;
  height: 72px;
  fill: #fff;
}

#backToExplore:hover {
  opacity: 0.7;
}

/* âœ… Hidden state (after 5 seconds) */
#backToExplore.hidden {
  opacity: 0;
  pointer-events: none; /* disables interaction while hidden */
}

/* Base page spacing */
.section {
  padding: 16px 12px;
}

/* Section titles */
.section-title {
  font-size: 18px;
  font-weight: 600;
  color: #fff; /* Adjust to match your app's theme */
  margin-bottom: 12px;
}

/* Horizontal scroll */
/* Fullscreen carousel container */
.carousel {
  display: flex;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  gap: 16px;
  padding: 12px 0;
  height: auto;
  -webkit-overflow-scrolling: touch;
}

.carousel::-webkit-scrollbar {
  display: none;
}

.carousel .movie-card {
  flex: 0 0 85vw;           /* ðŸ‘ˆ Responsive width: 85% of screen */
  max-width: 500px;         /* ðŸ‘ˆ Prevents it from being too big on large screens */
  height: auto;
  aspect-ratio: 2 / 3;      /* ðŸ‘ˆ Keeps poster ratio consistent */
  scroll-snap-align: start;
  border-radius: 12px;
  overflow: hidden;
  background: #111;
}

.carousel .movie-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 12px;
}


.carousel .movie-card {
  flex: 0 0 85vw;
  max-width: 500px;
  aspect-ratio: 2 / 3;
  scroll-snap-align: start;
  border-radius: 12px;
  overflow: hidden;
  background: #000;
  border: 2px solid rgba(255, 100, 0, 0.4); /* subtle inner border */
  box-shadow: 0 0 20px rgba(255, 100, 0, 0.4); /* âœ… neon glow */
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.carousel .movie-card:hover {
  transform: scale(1.03);
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.7); /* stronger glow on hover */
}

.carousel .movie-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  border-radius: 12px;
}

/* Grid layout for other sections */
.static-carousel {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px;
}

/* Movie card design */
.movie-card {
  background-color: #111;
  border-radius: 6px;
  overflow: hidden;
  position: relative;
  cursor: pointer;
  scroll-snap-align: start;
  transition: transform 0.2s ease;
}

.movie-card:hover {
  transform: scale(1.03);
}

/* Poster image */
.movie-card img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 6px;
}

/* Overlay with title + rating (optional) */
.movie-overlay {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 6px;
  background: rgba(0, 0, 0, 0.6);
  color: white;
  font-size: 12px;
  text-align: center;
}

//Live Search For TV
.search-results {
  position: absolute;
  top: 60px;
  left: 0;
  width: 100%;
  max-width: 600px;
  background: #1a1a1a;
  border-radius: 8px;
  border: 1px solid #333;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
  z-index: 9999;
  padding: 8px 0;
  overflow-y: auto;
  max-height: 320px;
  display: none;
}
.search-result-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  cursor: pointer;
  transition: background 0.2s ease;
}

.search-result-item:hover {
  background: rgba(255, 255, 255, 0.05);
}

.search-result-item img {
  width: 60px;
  height: 90px;
  object-fit: cover;
  border-radius: 4px;
}

.search-result-item .title {
  font-size: 16px;
  font-weight: 500;
  color: #fff;
}

.search-result-item .meta {
  font-size: 13px;
  color: #bbb;
}

.empty-state {
  text-align: center;
  padding: 20px;
  color: #777;
}

/* Movie thumbnail */
.search-result-item img {
  width: 60px;
  height: 90px;
  object-fit: cover;
  border-radius: 4px;
}

/* Title and meta text */
.search-result-item .title {
  font-size: 16px;
  font-weight: 500;
  color: #fff;
}

.search-result-item .meta {
  font-size: 13px;
  color: #bbb;
}

/* Empty state */
.empty-state {
  text-align: center;
  padding: 20px;
  color: #777;
}

//Movie Modal for TV
.movie-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 10, 10, 0.95);
  z-index: 10000;o
  display: none;
  overflow-y: auto;
}

.modal-content {
  max-width: 900px;
  margin: 40px auto;
  padding: 16px;
  background: #111;
  border-radius: 10px;
  color: #fff;
  position: relative;
}

.close-btn {
  position: absolute;
  right: 20px;
  top: 16px;
  font-size: 28px;
  cursor: pointer;
  color: #fff;
}

.modal-player iframe {
  width: 100%;
  height: 400px;
  border: none;
  border-radius: 8px;
}

.modal-details {
  padding: 16px 0;
}

.meta {
  color: #aaa;
  font-size: 14px;
}

.reviews {
  margin-top: 20px;
}

.reviews p {
  font-size: 14px;
  color: #ccc;
  border-bottom: 1px solid #333;
  padding-bottom: 8px;
  margin-bottom: 8px;
}

/*Css for Live Search*/
#liveSearchResults {
  position: absolute;
  top: 60px;
  left: 0;
  width: 100%;
  max-width: 600px;
  background: rgba(26, 26, 34, 0.95); /* translucent background */
  border-radius: 8px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
  z-index: 9999;
  padding: 8px 0;
  overflow-y: auto;
  max-height: 320px;
  display: none;
  backdrop-filter: blur(10px);
}

.section-header {
  padding: 16px;
  font-weight: bold;
  color: #fff;
}

.video-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  padding: 0 16px 32px;
}

  /* Premium Movie Card Styles */
  .movie-card {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    background: var(--card-bg);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    aspect-ratio: 2/3;
    cursor: pointer;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  
  .movie-card:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 12px 30px rgba(216, 27, 96, 0.4);
    border-color: var(--primary);
  }
  
  .movie-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }
  
  .movie-card:hover img {
    transform: scale(1.05);
  }
  
  .movie-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
    padding: 15px;
    color: white;
    transform: translateY(100%);
    transition: transform 0.3s ease;
  }
  
  .movie-card:hover .movie-overlay {
    transform: translateY(0);
  }
  
  .movie-overlay h4 {
    font-size: 16px;
    margin-bottom: 5px;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .movie-overlay span {
    font-size: 14px;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 5px;
  }
  
  .premium-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: linear-gradient(135deg, #ff8a00, #e52e71);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }
  
 
 #watchPage .browse-movies {
  position: fixed;
  top: 60px; /* Adjust if you have a top nav like search-container */
  width: 100%;
  z-index: 999;
  background: var(--bg); /* Prevent content overlap */
  padding: 20px 15px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
}
 #watchPage .section-header h3 {
  margin-top: 150px; /* or more depending on your fixed height */
}

  /* Video Grid Layout */
  #popularMoviesGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 20px;
    padding: 0 20px 40px;
  }
  
  @media (min-width: 768px) {
    #popularMoviesGrid {
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    }
  }
  
  @media (min-width: 1024px) {
    #popularMoviesGrid {
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
  }
  
  /* Watch Page General Styling */
#watchPage {
  padding: 16px;
  color: white;
}

/* Cast Section */
.cast-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 12px;
  margin-top: 12px;
}

.cast-card {
  text-align: center;
  background-color: #1f1f1f;
  border-radius: 8px;
  padding: 8px;
}

.cast-card img {
  width: 100%;
  height: auto;
  border-radius: 50%;
  margin-bottom: 6px;
}

.cast-card p {
  font-size: 12px;
  color: #ddd;
}

/* Reviews Section */
.review-box {
  background: linear-gradient(145deg, #1c1c1c, #222);
  box-shadow: 0 2px 4px rgba(0,0,0,0.6);
  color: #ddd;
  border-radius: 8px;
  padding: 14px;
  margin-bottom: 16px;
  font-size: 14px;
  line-height: 1.6;
}

/* Description */
.movie-description {
  font-size: 15px;
  color: #ddd;
  line-height: 1.6;
  margin-top: 12px;
}

.review-section {
  margin-top: 24px;
}

.review-box {
  background: #2b2b2b;
  color: #ddd;
  border-radius: 8px;
  padding: 14px;
  margin-bottom: 16px;
  font-size: 14px;
  line-height: 1.6;
}

.review-author {
  font-weight: bold;
  margin-bottom: 8px;
  color: #ffcc66;
  font-size: 13px;
}

.review-content {
  font-size: 14px;
  color: #ccc;
}

#watchPlaceholder {
  position: relative;
  z-index: 1;
}


#watchContent {
margin-top: 200px;
  padding-top: 30px; /* Increase this to push content BELOW the fixed player */
  color: white;
}

#videoContainer {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background-color: #000;
  z-index: 2000; /* â† bump this ABOVE the search bar's 1000 */
  padding: 0 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}

#videoContainer iframe {
  width: 100%;
  aspect-ratio: 16 / 9;
  border-radius: 8px;
  display: block;
  z-index: 2000;
}

.video-scroll-grid {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding-bottom: 12px;
  scrollbar-width: none;
}

.video-scroll-grid::-webkit-scrollbar {
  display: none;
}

.video-scroll-card {
  flex: 0 0 auto;
  width: 120px;
  text-align: center;
}

.video-scroll-card img {
  width: 100%;
  border-radius: 6px;
}

.video-scroll-card p {
  margin-top: 6px;
  font-size: 13px;
  color: #ccc;
}

.placeholder-wrapper {
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding: 16px;
  position: relative;
  z-index: 1;
}

.browse-movies {
  background: #1f1f1f;
  padding: 16px;
  border-radius: 12px;
  text-align: center;
}

.section-header h3 {
  font-size: 18px;
  margin: 0;
  color: white;
}

.video-grid {
  display: flex;
  overflow-x: auto;
  gap: 12px;
  padding-bottom: 10px;
}

.video-grid::-webkit-scrollbar {
  display: none;
}

/*helper text for iframe*/
.video-helper-note {
  font-size: 13px;
  color: #ccc;
  padding: 8px 0 12px;
  text-align: center;
  min-height: 20px;
  position: relative;
}

.helper-text {
  opacity: 0;
  position: absolute;
  left: 0;
  right: 0;
  transition: opacity 0.5s ease;
}

.helper-text.show {
  opacity: 1;
  position: relative;
}

.watch-toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1c1c1c;
  color: #f0f0f0;
  padding: 24px 32px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 500;
  max-width: 90%;
  width: 360px;
  text-align: center;
  z-index: 9999;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
  border: 1px solid #444;
  transition: opacity 0.4s ease, transform 0.4s ease;
}

.watch-toast span {
  display: inline-block;
  color: #00e0ff; /* distinct but premium */
  font-weight: 600;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  text-decoration: none;
  outline: none;
  margin-top: 8px;
}

.watch-toast span:hover {
  color: #00ffff;
  text-shadow: 0 0 8px rgba(0, 255, 255, 0.3);
  cursor: pointer;
}

/*For TvSeries*/
.video-container {
  position: fixed;
  top: 0; /* ðŸ‘ˆ Changed from 60px to 0 */
  left: 0;
  width: 100%;
  background: #000;
  z-index: 1001; /* ðŸ‘ˆ must be higher than the search bar (which is z-index: 1000) */
  padding: 0 12px;
}

.video-container iframe {
  width: 100%;
  aspect-ratio: 16/9;
  border-radius: 8px;
  border: none;
}

.series-info {
  margin-top: 0px; /* same or slightly more if search bar overlaps */
  padding: 16px;
}

.season-selector {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 24px;
  align-items: center;
}

#seasonSelect {
  background-color: #1f1f1f;
  color: #fff;
  border: 1px solid #444;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 14px;
  outline: none;
  appearance: none;
  cursor: pointer;
  min-width: 150px;
}

#seasonSelect:hover {
  border-color: #888;
}

.season-selector button {
  background: linear-gradient(135deg, #ff416c, #ff4b2b);
  color: white;
  border: none;
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease, transform 0.2s ease;
}

.season-selector button:hover {
  background: linear-gradient(135deg, #ff4b2b, #ff416c);
  transform: translateY(-2px);
}

/*for small screen*/
@media (max-width: 480px) {
  .season-selector {
    flex-direction: column;
    align-items: stretch;
  }

  .season-selector button,
  #seasonSelect {
    width: 100%;
  }
}

.episode-grid {
  display: flex;
  overflow-x: auto;
  gap: 16px;
  padding: 16px 0;
  scroll-snap-type: x mandatory;
}

.episode-card {
  flex: 0 0 auto;
  width: 220px;
  background: #1a1a1a;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s;
  scroll-snap-align: start;
  border: 1px solid #333;
}

.episode-card:hover {
  transform: translateY(-4px);
}

.episode-card img {
  width: 100%;
  height: auto;
  display: block;
}

.episode-number {
  padding: 6px 10px;
  background: #333;
  color: #fff;
  font-weight: bold;
  font-size: 13px;
}

.episode-info {
  padding: 10px;
  color: #ccc;
}

.episode-info h4 {
  margin: 0 0 6px;
  font-size: 15px;
  color: #fff;
}

.episode-info p {
  font-size: 13px;
  line-height: 1.4;
}
.episode-grid::-webkit-scrollbar {
  height: 8px;
}

.episode-grid::-webkit-scrollbar-thumb {
  background: #444;
  border-radius: 4px;
}

.providers {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 10px;
}

.providers img {
  border-radius: 4px;
}

/* back button for movie*/
.back-button {
  position: fixed;
  top: 0px;
  left: 1px;
  z-index: 9999;
  background: rgba(0, 0, 0, 0.6);
  padding: 2px;
  border-radius: 10%;
  cursor: pointer;
}

.back-button:hover {
  background: rgba(255, 255, 255, 0.2);
}

/*back button for TV*/
.back-button-tv {
  position: fixed;
  top: 0px;
  left: 1px;
  background: rgba(0, 0, 0, 0.7);
  padding: 2px;
  border-radius: 10%;
  z-index: 99999;
  cursor: pointer;
  transition: background 0.3s ease;
}

.back-button-tv:hover {
  background: rgba(255, 255, 255, 0.1);
}

.video-ad-wrapper {
  position: relative;
  width: 100%;
  max-width: 600px;
  margin: 20px auto;
  border-radius: 8px;
  overflow: hidden;
}

.adPlayer {
  position: relative;
  width: 100%;
  aspect-ratio: 16/9;
}

.adPlayer video {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.app-name-overlay {
  position: absolute;
  top: 10px;
  left: 10px;
  color: white;
  font-family: 'Poppins', sans-serif; /* Using your existing font */
  font-size: 9px;
  font-weight: 600;
  text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  z-index: 3; /* Ensure it appears above the video */
  padding: 4px 8px;
  border-radius: 4px;
  background: rgba(0,0,0,0.3); /* Slight background for better readability */
  backdrop-filter: blur(2px); /* Subtle blur effect */
  
  background: rgba(216, 27, 96, 0.3); /* Using your primary color with transparency */
}

/* Target the reload button specifically */
.reload-btn {
    background: transparent !important;
    padding: 0 !important;
    border: none !important;
    cursor: pointer;
    border-radius: 50%;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    transition: background 0.3s ease, transform 0.2s ease;
}

.reload-btn:hover {
    background: rgba(255, 255, 255, 0.08) !important;
    transform: scale(1.05);
}

.reload-btn svg {
    width: 32px;
    height: 32px;
    fill: var(--text); /* takes theme text color */
    transition: transform 0.4s ease, fill 0.3s ease;
}

.reload-btn:hover svg {
    transform: rotate(180deg);
    fill: var(--primary);
}

/* Override the general search container button styles for reload button */
.search-container .reload-btn {
    background: transparent !important;
    box-shadow: none !important;
    margin-left: 0 !important; /* Remove the left margin if needed */
}

.search-container .reload-btn:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    transform: scale(1.05);
}

    </style>
</head>
<body>
     
   <div class="search-container" id="searchBarContainer" style="display: none;">
  <div class="search-wrapper">
    <!-- âœ… Live Search Results (Place this right below the input) -->
    <div id="liveSearchResults" class="search-results" style="display: none;"></div>
    
    <button id="reloadBtn" class="reload-btn" title="Reload">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
    <path d="M470.7,280.2c2.9-11.2,4.7-22.9,4.7-35c0-75.8-61.4-137.1-137.1-137.1c-19.5,0-37.9,4.1-54.7,11.4
      c-16.8-39-55.6-66.3-100.7-66.3c-60.6,0-109.7,49.1-109.7,109.7c0,4.1,0.8,7.9,1.2,11.9C30.5,195.1,0,239.3,0,290.9
      c0,70.7,57.3,128,128,128h310.9c40.4,0,73.1-32.7,73.1-73.1C512,316.8,495.1,292.1,470.7,280.2z M365.7,254.3h-91.4l33.4-33.4
      c-13.2-13.2-31.5-21.4-51.7-21.4c-40.4,0-73.1,32.7-73.1,73.1s32.7,73.1,73.1,73.1c24.9,0,46.8-12.5,60-31.4l25.9,25.9
      c-20.1,25.5-50.9,42.2-85.8,42.2c-60.6,0-109.7-49.1-109.7-109.7c0-60.6,49.1-109.7,109.7-109.7c30.3,0,57.7,12.3,77.6,32.1
      l32.1-32.1V254.3z"></path>
  </svg>
</button>

    <button id="homeBtn" class="reload-btn" title="Go to Explore">
  <svg width="20" height="20" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill="var(--primary)" d="M43.4,8.3L4,15l-0.3-2c-0.4-2.2,1.1-4.2,3.3-4.6l31.6-5.3c2.2-0.4,4.2,1.1,4.6,3.3L43.4,8.3z"></path>
    <path fill="var(--card-bg)" d="M40,41H8c-2.2,0-4-1.8-4-4V15h40v22C44,39.2,42.2,41,40,41z"></path>
    <g fill="var(--primary-dark)">
        <polygon points="18.8,6.4 23.7,11.7 27.7,11 22.7,5.7"></polygon>
        <polygon points="10.9,7.7 15.8,13 19.8,12.3 14.8,7.1"></polygon>
        <polygon points="26.7,5.1 31.6,10.3 35.5,9.7 30.6,4.4"></polygon>
        <polygon points="34.5,3.8 39.5,9 43.4,8.3 38.5,3.1"></polygon>
    </g>
    <circle fill="var(--primary)" cx="7.5" cy="11.5" r="1.5"></circle>
    <g fill="var(--text)">
        <polygon points="40,15 36,21 40,21 44,15"></polygon>
        <polygon points="32,15 28,21 32,21 36,15"></polygon>
        <polygon points="24,15 20,21 24,21 28,15"></polygon>
        <polygon points="16,15 12,21 16,21 20,15"></polygon>
        <polygon points="8,15 4,21 8,21 12,15"></polygon>
    </g>
</svg>
</button>

    <input type="text" id="search" placeholder="Discover trailers, movies, anime...">
    <button id="searchBtn">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"></circle>
    <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"></path>
  </svg>
</button>

    <div class="search-history" id="searchHistoryList"></div>
  </div>
</div>


    <div id="explorePage" class="page active">
        <div id="exploreCarousel"></div>
   <div class="video-ad-wrapper">
  <div class="adPlayer">
    <div class="app-name-overlay">tubetrailer</div>
    
    <!-- Primary visible video -->
    <video id="vidA" autoplay muted playsinline style="position: absolute; width: 100%; height: 100%">
      <source src="" type="video/mp4">
    </video>
    
    <!-- Hidden secondary video (for preloading) -->
    <video id="vidB" muted playsinline style="position: absolute; width: 100%; height: 100%; opacity: 0">
      <source src="" type="video/mp4">
    </video>
    
    <a href="#" id="videoLink" class="video-link" target="_blank" rel="noopener"></a>
  </div>
  
  <button class="mute-toggle" onclick="toggleMute()">
    <i class="fas fa-volume-up" id="muteIcon"></i>
  </button>
  <div class="ad-label">Ad</div>
</div>


<div class="native-ad-section">
    <div class="native-ad-card">
        <div class="ad-header">
            <span class="sponsored-badge">Sponsored</span>
            <i class="fas fa-ad"></i>
        </div>
        <div class="ad-content">
            <script async="async" data-cfasync="false" src="//pubertytechnicallyknowhow.com/89f1e40e0e6d7dcb91eb378512134e8a/invoke.js"></script>
            <div id="container-89f1e40e0e6d7dcb91eb378512134e8a"></div>
        </div>
    </div>
</div>

        <div class="content" id="exploreContent">
            <div id="forYouSection" style="display: none;">
                <h2 class="section-title">For You</h2>
                <div class="results-container" id="forYouResults"></div>
            </div>
           <div id="trailerSection">
    <h2 class="section-title">Top Trailers</h2>
    <div class="results-container" id="trailerResults">
        <!-- First trailer thumbnail will be inserted here by JavaScript -->
        
        <!-- ADD THE AD CONTAINER RIGHT AFTER THE FIRST TRAILER -->
        <div class="ad-section">
            <span class="ad-label">Advertisement</span>
            <div id="ad-container"></div>
            <div id="status" class="status-overlay">Initializing ad player...</div>
        </div>
    </div>
</div>

            <!-- Add this right after the Top Trailers section in your HTML for guy-->
<div class="native-ad-section">
    <div class="native-ad-card">
        <div class="ad-header">
            <span class="sponsored-badge">Sponsored</span>
            <i class="fas fa-ad"></i>
        </div>
        <div class="ad-content">
            <script async="async" data-cfasync="false" src="//pl27314849.profitableratecpm.com/5b6af9f8e2d4fd83a74b711e856d7965/invoke.js"></script>
            <div id="container-5b6af9f8e2d4fd83a74b711e856d7965"></div>
        </div>
    </div>
</div>
            <div id="moviesSection">
                <h2 class="section-title">Top Movies</h2>
                <div class="results-container" id="moviesResults"></div>
            </div>
            <div id="animeSection">
                <h2 class="section-title">Top Anime</h2>
                <div class="results-container" id="animeResults"></div>
            </div>
        </div>
        <div class="results-container" id="searchResults" style="display: none;">
             <div id="pullToExplore" style="
    text-align: center;
    padding: 10px;
    font-size: 14px;
    color: var(--text-secondary);
    background: rgba(255,255,255,0.03);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
">
  â¬‡ Pull down to return to Explore
</div>
        </div>
    </div>


<!-- Player Page -->
<div id="playerPage" class="page">
     <div id="backToExplore">
  <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="28" height="28" viewBox="0 0 24 24">
    <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6z"></path>
  </svg>
</div>
    <div class="fixed-player">
        <div class="player-container">
            <div class="player-wrapper">
                <iframe id="ytplayer" allowfullscreen></iframe>
            </div>
        </div>
    </div>
        
        
    <!-- Video Info Section -->
    <div class="scrollable-content">
        <div class="video-info-container">
            <h1 class="video-title" id="videoTitle">Loading...</h1>
            <div class="video-stats" id="videoStats">
                <span id="viewCount">...</span>
                <span>â€¢</span>
                <span id="uploadDate">...</span>
            </div>
            
            <div class="video-actions">
                <!-- Like Button -->
                <button class="action-button like" id="likeButton">
                    <svg class="action-icon" viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M23 10a2 2 0 0 0-2-2h-6.32l.96-4.57c.02-.1.03-.21.03-.32a1 1 0 0 0-1.7-.72l-6.58 6.59c-.37.37-.58.88-.58 1.41V19a2 2 0 0 0 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73V10zM1 21h4V9H1v12z"></path>
                    </svg>
                    <span id="likeCount">...</span>
                </button>

                <!-- Dislike Button -->
                <button class="action-button" id="dislikeButton">
                    <svg class="action-icon" viewBox="0 0 24 24" width="24" height="24">
                        <path fill="currentColor" d="M1 12c0-1.1.9-2 2-2h6.32l-.97 4.57c-.02.1-.03.21-.03.32 0 .42.17.79.44 1.06L9.83 23l6.59-6.59c.36-.36.58-.86.58-1.41V5a2 2 0 0 0-2-2H5c-.83 0-1.54.5-1.84 1.22l-3.02 7.05c-.09.23-.14.47-.14.73v2.16l.01.01L1 12zm22 0h-4V4h4v8z"></path>
                    </svg>
                    <span>Dislike</span>
                </button>

            </div>              
            
                                    
            <div id="adWrap" style="width: 100%; max-width: 390px; margin: 10px auto;">
  <div id="adDropDown" style="position: relative; background: #1e1e1e; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); padding: 10px;">
    
    <!-- âœ… Adsterra banner widget (load only once!) -->
    <script async="async" data-cfasync="false" src="//pubertytechnicallyknowhow.com/89f1e40e0e6d7dcb91eb378512134e8a/invoke.js"></script>
    <div id="container-89f1e40e0e6d7dcb91eb378512134e8a"></div>
  
  </div>

  <!-- Toggle button -->
  <div style="text-align: right; margin-top: 5px;">
    <button id="toggleAd" style="border: none; background: transparent; cursor: pointer; color: #aaa;">
  <svg id="toggleIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 320 512" fill="currentColor">
    <path id="togglePath" d="M96 320c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25l96-96c12.5-12.5 32.75-12.5 45.25 0l96 96c12.5 12.5 12.5 32.75 0 45.25s-32.75 12.5-45.25 0L160 237.3l-73.4 73.38C112.4 316.9 104.2 320 96 320z"></path>
  </svg>
</button>
  </div>
</div>
            <div class="channel-info">
                <div class="channel-details">
                    <img
  id="channelAvatar"
  src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nNDAnIGhlaWdodD0nNDAnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zyc+PHJlY3Qgd2lkdGg9JzQwJyBoZWlnaHQ9JzQwJyByeD0nMjAnIGZpbGw9JyNlZWUnIC8+PHRleHQgeD0nMTAnIHk9JzI0JyBmb250LXNpemU9JzEwJyBmaWxsPScjY2NjJz5BPC90ZXh0Pjwvc3ZnPg=="
  alt="Channel Avatar"
  width="40"
  height="40"
  style="border-radius: 50%;"
/>
                    <div>
                        <div class="channel-name" id="channelName">...</div>
                        <div class="channel-subs" id="channelSubs">...</div>
                    </div>
                </div>
                <span id="subStatus" class="yt-subscribed">Subscribed</span>
            </div>
        </div>
        
        <!-- Related Videos Section -->
        <div class="related-videos">
            <h2 class="related-title">Related Videos</h2>
            <div class="video-grid" id="relatedVideosGrid">
                <!-- Related videos will be inserted here -->
            </div>
        </div>
    </div>
</div>


 <!-- Me Page -->
<div id="mePage" class="page">
    <div class="profile-header">
        <div class="profile-banner"></div>
        <div class="profile-avatar-container">
            <div class="profile-avatar">
                <img id="userAvatarImg" src="https://via.placeholder.com/100" alt="User Avatar">
                <div class="avatar-glow"></div>
            </div>
            <h3 id="userProfileName">Guest User</h3>
            <p id="userStatus">Basic Member</p>
        </div>
        <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
    </div>
    <div class="me-content">
        <div class="stats-grid">
            <div class="stat-card">
                <i class="fas fa-history"></i>
                <h4>Watch History</h4>
                <p><span id="meWatchHistoryCount">0</span> Videos</p>
            </div>
            <div class="stat-card">
                <i class="fas fa-search"></i>
                <h4>Search History</h4>
                <p><span id="meSearchHistoryCount">0</span> Searches</p>
            </div>
        </div>
        <div class="settings-grid">
            <div class="settings-item" id="accountBtn">
                <i class="fas fa-user-circle"></i>
                <span>Account</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="themeBtn">
                <i class="fas fa-adjust"></i>
                <span>Switch Theme</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span>Notifications</span>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="aboutBtn">
                <i class="fas fa-info-circle"></i>
                <span>About</span>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>
    </div>
</div>

<!-- ðŸŽ¬ TV/Movies Tab -->
<div class="page" id="tvPage">
  <div class="section">
    <h2 class="section-title">Trending</h2>
    <div class="carousel" id="trendingCarousel"></div>
  </div>

  <div class="section">
    <h2 class="section-title">Popular </h2>
    <div class="static-carousel" id="popularGrid"></div>
  </div>

  <div class="section">
    <h2 class="section-title">Top Rated </h2>
    <div class="static-carousel" id="topRatedGrid"></div>
  </div>

  <div class="section">
    <h2 class="section-title">Upcoming</h2>
    <div class="static-carousel" id="upcomingGrid"></div>
  </div>

  <!-- âœ… Add these -->
  <div class="section">
    <h2 class="section-title">Popular TV Shows</h2>
    <div class="static-carousel" id="popularTVGrid"></div>
  </div>

  <div class="section">
    <h2 class="section-title">Top Rated TV Shows</h2>
    <div class="static-carousel" id="topRatedTVGrid"></div>
  </div>
</div>

<!-- ðŸ‘‡ Add this after your other `.page` containers -->
<div id="watchPlaceholder" style="padding: 16px;">

  </div>
</div>    


<div id="watchPage" class="page">

  <!-- âœ… Movie Content (hidden initially, shown on movie click) -->
  <div id="watchContent" style="display: none; padding: 16px;"></div>

</div>
    <div class="pagination-container" id="explorePagination" style="display: none;">
        <div class="pagination">
            <button id="explorePrevBtn" onclick="prevPage()"><i class="fas fa-chevron-left"></i> Previous</button>
            <button id="exploreNextBtn" onclick="nextPage()">Next <i class="fas fa-chevron-right"></i></button>
        </div>
    </div>

    <!-- Bottom Navigation -->
<div class="bottom-nav">
      <a href="#" class="nav-item" data-page="playerPage">
        <svg class="nav-icon" viewBox="0 0 24 24" width="24" height="24">
            <path fill="currentColor" d="M8 5v14l11-7z"></path>
        </svg>
        <span>Player</span>
    </a>
    <a href="#" class="nav-item active" data-page="explorePage">
         <svg class="nav-icon" viewBox="0 0 24 24" width="26" height="26">
            <path fill="currentColor" d="M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm2.19 12.19L6 18l3.81-8.19L18 6l-3.81 8.19z"></path>
        </svg>
        <span>Explore</span>
    </a>
  
<a href="#" class="nav-item" data-page="tvPage" onclick="switchTab('tvPage')">
  <svg class="nav-icon" viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
    <path d="M20 6h-4.586l3.293-3.293-1.414-1.414L12 6.586 6.707 1.293 5.293 2.707 8.586 6H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2zm0 14H4V8h16v12z"></path>
  </svg>
  <span>TV/Movies</span>
</a>

   <a href="#" class="nav-item" data-page="mePage">
  <svg class="nav-icon" viewBox="0 0 24 24" width="28" height="28" fill="currentColor">
    <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"></path>
  </svg>
  <span>Me</span>
</a>
</div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>

    <div class="error-message" id="errorMessage"></div>
    
    
   <!-- Auth Modal -->
<div id="authModal" class="modal">
    <div class="modal-content">
        <div class="auth-cta">
            <h3 id="authModalTitle">Join TUBE TRAILER </h3>
            <p id="authModalBlurb"> Sign in to unlock personalized trailers, anime alerts, and early downloads.</p>
<p style="opacity: 0.7; font-size: 13px;">Tap anywhere to continue without signing in</p>

        </div>
        <form id="authForm">
            <input type="email" class="modal-input" id="authEmail" placeholder="Email" required>
            <input type="password" class="modal-input" id="authPassword" placeholder="Password" required>
            <select class="modal-input" id="contentPreferences" name="contentPreferences" required>
                <option value="" disabled selected>Select your favorite content type</option>
                <option value="action">Action</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="horror">Horror</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="romance">Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="adventure">Adventure</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="anime">Anime</option>
                <option value="music">Music</option>
                <option value="gaming">Gaming</option>
                <option value="vlogs">Vlogs</option>
                <option value="tutorials">Tutorials</option>
                <option value="cooking">Cooking</option>
                <option value="sports">Sports</option>
            </select>
            <div class="modal-actions">
                <button type="button" class="modal-btn secondary" id="cancelAuthBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="toggleAuthBtn">Switch to <span id="authToggleText">Login</span></button>
                <button type="submit" class="modal-btn primary" id="authSubmitBtn">Sign Up</button>
            </div>
            
            <label>
  <input type="checkbox" id="dontShowAuthCheckbox"> Don't show this again
</label>
        </form>
        <p id="authError" style="color: #ff4757; display: none; margin-top: 10px;"></p>
    </div>
</div>

<div id="accountModal" class="modal">
    <div class="modal-content">
        <h2>Account Settings</h2>
        <form id="accountForm">
            <select class="modal-input" id="accountContentPreferences" required>
                <option value="" disabled>Select your favorite content type</option>
                <option value="action">Action</option>
                <option value="comedy">Comedy</option>
                <option value="drama">Drama</option>
                <option value="horror">Horror</option>
                <option value="sci-fi">Sci-Fi</option>
                <option value="romance">Romance</option>
                <option value="thriller">Thriller</option>
                <option value="fantasy">Fantasy</option>
                <option value="adventure">Adventure</option>
                <option value="animation">Animation</option>
                <option value="documentary">Documentary</option>
                <option value="anime">Anime</option>
                <option value="music">Music</option>
                <option value="gaming">Gaming</option>
                <option value="vlogs">Vlogs</option>
                <option value="tutorials">Tutorials</option>
                <option value="cooking">Cooking</option>
                <option value="sports">Sports</option>
            </select>
            <div class="modal-actions">
                <button type="submit" class="modal-btn primary" id="saveAccountBtn">Save</button>
                <button type="button" class="modal-btn secondary" id="cancelAccountBtn">Cancel</button>
                <button type="button" class="modal-btn secondary" id="signOutBtn">Sign Out</button>
            </div>
        </form>
    </div>
</div>

   <!-- Notification Modal -->
<div id="notificationModal" class="modal">
    <div class="modal-content">
        <span id="closeNotificationBtn" class="close-btn">Ã—</span>
        <h2>Notifications</h2>
        <ul class="notification-list">
            <li><strong>Update:</strong> 250+ Movies added.</li>
            <li><strong>New:</strong> Explore tab now supports all content types.</li>
            <li><strong>Tip:</strong> Instant Download is coming soon.</li>
        </ul>
    </div>
</div>

    <div id="aboutModal" class="modal">
    <div class="modal-content premium-modal">
        <span class="close-btn" onclick="hideAboutModal()">Ã—</span>
        <div class="premium-header">
            <h1 class="app-name">TUBE TRAILER</h1>
            <span class="premium-badge">Premium</span>
        </div>
        <p class="premium-blurb">
            Experience the ultimate entertainment hub with TUBE TRAILER Premium. 
            Dive into a curated world of trending trailers, full-length movies, 
            and exclusive anime, personalized to your tastes. Enjoy seamless 
            streaming, offline downloads, and a sleek, ad-free interface designed 
           just for you!.
        </p>
        <div class="app-version">
            <span>Version 1.2.3</span>
        </div>
    </div>
</div>


<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut as firebaseSignOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDFnJwljFcRLcvyfkMCZOtJsabPQAzyXz4",
        authDomain: "tubetrailer.firebaseapp.com",
        projectId: "tubetrailer",
        storageBucket: "tubetrailer.firebasestorage.app",
        messagingSenderId: "935645040633",
        appId: "1:935645040633:web:0cc787b288158f66213728"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const apiKeys =
     [
    "AIzaSyAMw0mfpXiqtfN7BbVzhh4YrItgCcZv9J8",
    
     "AIzaSyAZe5WtOh-Tiuz8eqswJtoPs7oPVdyGquY", "AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc",
    "AIzaSyC_syRSRRxQR1DbtHZzMw9glxcR7My8ly4",

"AIzaSyABi7KdpAijF9gu09dSefpXJyhjIRY66Eg",
            "AIzaSyAqLty-6vku33b3bpdG5S4oLkyoimdw8TU",
            "AIzaSyBYixFCdGHJ2P512iW010glQRvd93EB6O8",
            "AIzaSyDLW2mkmVVgQcoUpM86VFtOaCegFvyVk_g",
            "AIzaSyDe7rOrqZFH3vIqP9zBtNkQ0Lqz4mBz9BI",
            "AIzaSyDFH66idOZwfx-PfO1AXdsUeCa2gV1kCk4",

"AIzaSyAlbWmxyzhL2RaNPNlPsANzY7R0JZUj_TU",

"AIzaSyC4WKW6-m7RlZyu6EctRsN9XjiOz5Z7GWk",

"AIzaSyDSBtLwMoliYaFW09BnVyzTQADrGABHzKw",
"AIzaSyCME7E2t1cd8JTwpXIgDSyAwVMja2QHkL8",

"AIzaSyDdrHGuGB5IKzv6_h7Dkgc60magvKu7YRI",

"AIzaSyDKnfDW7ujsfEFFGV3kWxsmQg9DDtRAUTM",

"AIzaSyC7v1svD5oJFa9Sg4aXFvatOMiwKB2EG2A",

"AIzaSyBS1tt0v9_lLc5HAIAFMkTYbRzVUL27yI0",

"AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc"
   ];
   
   // YouTube API Keys
const API_KEYS = [
    'AIzaSyC_syRSRRxQR1DbtHZzMw9glxcR7My8ly4',
    'AIzaSyABi7KdpAijF9gu09dSefpXJyhjIRY66Eg',
    'AIzaSyAqLty-6vku33b3bpdG5S4oLkyoimdw8TU',
    'AIzaSyBYixFCdGHJ2P512iW010glQRvd93EB6O8',
    'AIzaSyDLW2mkmVVgQcoUpM86VFtOaCegFvyVk_g',
    'AIzaSyDe7rOrqZFH3vIqP9zBtNkQ0Lqz4mBz9BI',
    'AIzaSyDFH66idOZwfx-PfO1AXdsUeCa2gV1kCk4',
    'AIzaSyAlbWmxyzhL2RaNPNlPsANzY7R0JZUj_TU',
    'AIzaSyC4WKW6-m7RlZyu6EctRsN9XjiOz5Z7GWk',
    'AIzaSyDSBtLwMoliYaFW09BnVyzTQADrGABHzKw',
    'AIzaSyCME7E2t1cd8JTwpXIgDSyAwVMja2QHkL8',
    'AIzaSyDdrHGuGB5IKzv6_h7Dkgc60magvKu7YRI',
    'AIzaSyDKnfDW7ujsfEFFGV3kWxsmQg9DDtRAUTM',
    'AIzaSyC7v1svD5oJFa9Sg4aXFvatOMiwKB2EG2A',
    'AIzaSyBS1tt0v9_lLc5HAIAFMkTYbRzVUL27yI0',
    'AIzaSyDRA0Fzdwg5oIIxBBt2NowcrdbeucEa6cc'
];

let currentApiKeyIndex = 0;
    let currentKeyIndex = 0;

    let exploreCurrentPage = 0;
    let exploreTotalResults = [];
    const resultsPerPage = 26;

const PROXY_URL = 'https://d1-templatevideo.winnerukoh.workers.dev/';

let isLiked = false;
let isDisliked = false;
let isSubscribed = true;
    let trailerResults = [];
    let movieResults = [];
    let animeResults = [];

    let isSignUpMode = true;
    
    const ytPlayer = document.getElementById('ytplayer');
const videoTitle = document.getElementById('videoTitle');
const viewCount = document.getElementById('viewCount');
const uploadDate = document.getElementById('uploadDate');
const likeCount = document.getElementById('likeCount');
const channelAvatar = document.getElementById('channelAvatar');
const channelName = document.getElementById('channelName');
const channelSubs = document.getElementById('channelSubs');
const relatedVideosGrid = document.getElementById('relatedVideosGrid');


    
    // Add this with your other variable declarations
let currentView = {
  page: 'explorePage',
  isSearchView: false
};


function updatePagination() {
    const paginationContainer = document.getElementById('explorePagination');
    const prevBtn = document.getElementById('explorePrevBtn');
    const nextBtn = document.getElementById('exploreNextBtn');
    
    if (!paginationContainer || !prevBtn || !nextBtn) return;
    
    const totalPages = Math.ceil(exploreTotalResults.length / resultsPerPage);
    
    // Disable previous button on first page
    prevBtn.disabled = exploreCurrentPage === 0;
    prevBtn.style.opacity = exploreCurrentPage === 0 ? '0.5' : '1';
    
    // Disable next button on last page
    nextBtn.disabled = exploreCurrentPage >= totalPages - 1;
    nextBtn.style.opacity = exploreCurrentPage >= totalPages - 1 ? '0.5' : '1';
    
    // Show pagination only if there are multiple pages
    paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none';
}

function openWatchPageEmpty() {
  switchTab("watchPage");
  setTimeout(() => {
    loadPopularMovies();
  }, 100); // or 150ms
}

    function getApiKey() {
        return apiKeys[currentKeyIndex];
    }

//caching for you results 
const cachedForYouResults = loadFromCache('cachedForYouResults') || [];

    function switchApiKey() {
        currentKeyIndex = (currentKeyIndex + 1) % apiKeys.length;
        console.log(`Switched to API key ${currentKeyIndex + 1}`);
        if (currentKeyIndex === 0) {
            showError("Failed to Load. Please try again in a min. Apologies User we are working on it");
            throw new Error("Try Again in 1 min");
        }
    }
function getVideoId() {
  const params = new URLSearchParams(window.location.search);
  let videoId = params.get('v');

  // If not in query string, check the hash
  if (!videoId && window.location.hash) {
    const hash = window.location.hash;

    // Match patterns like #v=abc123 or #watch?v=abc123
    const match = hash.match(/[?&#]v=([^&]+)/);
    if (match && match[1]) {
      videoId = match[1];
    }
  }

  // Optional: Clean up the video ID (remove extra characters)
  if (videoId) {
    videoId = videoId.split('&')[0]; // in case of trailing params
  }

  return videoId;
}


    function showLoading(show) {
        document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }

    function showError(message) {
        const errorDiv = document.getElementById('errorMessage');
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => {
            errorDiv.style.display = 'none';
        }, 5000);
    }

    function showAuthError(message) {
        const errorElement = document.getElementById('authError');
        errorElement.textContent = message;
        errorElement.style.display = 'block';
    }

function saveToCache(key, data) {
  try {
    const cacheEntry = {
      data,
      timestamp: new Date().toISOString()
    };
    localStorage.setItem(key, JSON.stringify(cacheEntry));
    console.log(`[ðŸ’¾ CACHE: SAVE] Key: ${key}`);
    console.log(`[ðŸ’¾ CACHE: SAVE] Timestamp: ${cacheEntry.timestamp}`);
    console.log(`[ðŸ’¾ CACHE: SAVE] Data Type: ${typeof data}`);
    console.log(`[ðŸ’¾ CACHE: SAVE] Data Preview:`, Array.isArray(data) ? data.slice(0, 2) : data);
    console.log(`[ðŸ’¾ CACHE: SAVE] Data Length:`, Array.isArray(data) ? data.length : 'N/A');
  } catch (e) {
    console.error(`[âŒ CACHE: SAVE ERROR] Key: ${key}`, e);
  }
}

function loadFromCache(key, maxAgeHours = 24) {
  const raw = localStorage.getItem(key);
  if (!raw) {
    console.warn(`[ðŸ“¦ CACHE: LOAD] Key "${key}" not found in localStorage.`);
    return null;
  }

  try {
    const cacheEntry = JSON.parse(raw);
    if (!cacheEntry || !cacheEntry.timestamp || !cacheEntry.data) {
      console.warn(`[âš ï¸ CACHE: FORMAT ERROR] Key: ${key} â€” Missing required fields.`);
      return null;
    }

    const ageMs = new Date() - new Date(cacheEntry.timestamp);
    const ageHours = ageMs / (1000 * 60 * 60);

    console.log(`[ðŸ“¦ CACHE: LOAD] Key: ${key}`);
    console.log(`[ðŸ“¦ CACHE: LOAD] Age: ${ageHours.toFixed(2)} hours`);
    console.log(`[ðŸ“¦ CACHE: LOAD] Max Age Allowed: ${maxAgeHours} hours`);

    if (ageHours > maxAgeHours) {
      console.warn(`[â° CACHE: EXPIRED] Key: ${key} is too old. Ignoring.`);
      return null;
    }

    console.log(`[âœ… CACHE: VALID] Returning data for key: ${key}`);
    return cacheEntry.data;
  } catch (e) {
    console.error(`[âŒ CACHE: PARSE ERROR] Key: ${key}`, e);
    return null;
  }
}


    function escapeHtml(unsafe) {
        if (!unsafe) return '';
        return unsafe
            .replace(/&/g, "&")
            .replace(/</g, "<")
            .replace(/>/g, ">")
            
            .replace(/'/g, "'");
    }


    function showSearchHistory() {
        const history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        const list = document.getElementById('searchHistoryList');
        const displayItems = history.slice(0, 10);

        list.innerHTML = '';
        displayItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'search-history-item';
            div.textContent = item.query;
            div.onclick = () => {
                document.getElementById('search').value = item.query;
                list.style.display = 'none';
                searchContent();
            };
            list.appendChild(div);
        });

        if (displayItems.length > 0) {
            list.style.display = 'block';
        }
    }

    function hideSearchHistory() {
        setTimeout(() => {
            document.getElementById('searchHistoryList').style.display = 'none';
        }, 150);
    }

    function filterSearchHistory() {
        const input = document.getElementById('search').value.toLowerCase();
        const allItems = document.querySelectorAll('.search-history-item');

        allItems.forEach(item => {
            item.style.display = item.textContent.toLowerCase().includes(input) ? 'block' : 'none';
        });
    }



function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');

    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === pageId) {
            item.classList.add('active');
        }
        
    });
        

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(toast);
        }, 300);
    }, 3000);
}


    // Hide search bar on Me & Shorts pages
    const searchBar = document.querySelector('.search-container');
    if (pageId === 'mePage' || pageId === 'shortsPage' || pageId === 'downloadsPage') {
    searchBar.style.display = 'none';
} else {
    searchBar.style.display = 'flex';
}

    // Load content when switching tabs
    if (pageId === 'explorePage') {
        const cachedTrailerResults = loadFromCache('cachedTrailerResults') || [];
        const cachedMovieResults = loadFromCache('cachedMovieResults') || [];
        const cachedAnimeResults = loadFromCache('cachedAnimeResults') || [];
        if (cachedTrailerResults.length > 0 && cachedMovieResults.length > 0 && cachedAnimeResults.length > 0) {
            console.log('Loading cached explore results from localStorage for explore page:', {
                trailerResults: cachedTrailerResults.length + ' items',
                movieResults: cachedMovieResults.length + ' items',
                animeResults: cachedAnimeResults.length + ' items'
            });
            trailerResults = cachedTrailerResults;
            movieResults = cachedMovieResults;
            animeResults = cachedAnimeResults;
            displayExploreContent();
            createExploreCarousel();
            fetchForYouContent();
        } else {
            console.log('No valid cached explore results found or cache expired for explore page. Fetching new content.');
            fetchExploreContent();
        }
    } else if (pageId === 'shortsPage') {
        document.body.classList.add('shorts-open');
        
        document.body.classList.remove('shorts-open');
    }

    // Hide pagination on non-explore pages
    document.querySelectorAll('.pagination-container').forEach(p => {
        p.style.display = pageId === 'explorePage' ? 'flex' : 'none';
    });
}


    async function fetchExploreContent() {
    showLoading(true);
    try {
        const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=30&q=latest+movie+trailers&type=video&key=${getApiKey()}`);
        const trailerData = await trailerResponse.json();
        if (trailerData.error) {
            if (trailerData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(trailerData.error.message);
        }
        trailerResults = sortItemsByPublishedDate(trailerData.items || []);

        const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=30&q=latest+full+movie+-trailer&type=video&key=${getApiKey()}`);
        const movieData = await movieResponse.json();
        if (movieData.error) {
            if (movieData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(movieData.error.message);
        }
        const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
        const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
        const movieDetailsData = await movieDetailsResponse.json();
        const fullMovies = movieData.items.map(item => ({
            ...item,
            contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));
        movieResults = sortItemsByPublishedDate(fullMovies.filter(isFullLengthVideo));

        const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=latest+anime+trailer+OR+full+movie+-review&type=video&key=${getApiKey()}`);
        const animeData = await animeResponse.json();
        if (animeData.error) {
            if (animeData.error.code === 403) {
                switchApiKey();
                return fetchExploreContent();
            }
            throw new Error(animeData.error.message);
        }
        const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
        const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
        const animeDetailsData = await animeDetailsResponse.json();
        const fullAnime = animeData.items.map(item => ({
            ...item,
            contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));
        animeResults = sortItemsByPublishedDate(fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video)));

        // Cache the results with timestamp
        saveToCache('cachedTrailerResults', trailerResults);
        saveToCache('cachedMovieResults', movieResults);
        saveToCache('cachedAnimeResults', animeResults);

        displayExploreContent();
        createExploreCarousel();
        fetchForYouContent();
    } catch (error) {
        showError(`Failed to load content. Apologies User, we are working on it. hold on a bit: ${error.message}`);
    } finally {
        showLoading(false);
    }
}

function isAnimeRelated(video) {
        const title = video.snippet.title?.toLowerCase() || '';
        const description = video.snippet.description?.toLowerCase() || '';

        const animeKeywords = [
            'anime', 'episode', 'series', 'season', 'part', 'opening', 'ending',
            'dub', 'sub', 'subbed', 'dubbed', 'watch online', 'full episode',
            'naruto', 'one piece', 'bleach', 'attack on titan',
            'my hero', 'boku no hero', 'mha', 'demon slayer', 'tokyo ghoul', 'dragon ball',
            'sailor moon', 'cowboy bebop', 'code geass', 'death note', 'evangelion',
            'pokemon', 'dbz', 'goku', 'luffy', 'eren', 'levi', 'itachi', 'madara',
            'shonen', 'shoujo', 'isekai', 'mecha', 'fantasy', 'adventure', 'action',
            'comedy', 'romance', 'slice of life', 'ecchi', 'harem', 'school', 'horror',
            'crunchyroll', 'funimation', 'animelab', 'neon genesis', 'myanimelist',
            'aniplex', 'madhouse', 'ufotable', 'bones', 'studio pierrot'
        ];

        return animeKeywords.some(kw => title.includes(kw) || description.includes(kw));
    }
    

    function createExploreCarousel() {
        const carouselItems = [
            ...trailerResults.slice(0, 4),
            ...movieResults.slice(0, 4),
            ...animeResults.slice(0, 4)
        ].sort(() => Math.random() - 0.5).slice(0, 12);
        createCarousel('exploreCarousel', carouselItems);
    }

    function createCarousel(containerId, items) {
    const container = document.getElementById(containerId);
    if (!container || !items || items.length === 0) return;

    container.innerHTML = `
        <div class="carousel-container">
            <div class="carousel-track" id="${containerId}-track"></div>
            <div class="carousel-nav carousel-prev" onclick="moveCarousel('${containerId}', -1)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
            <div class="carousel-nav carousel-next" onclick="moveCarousel('${containerId}', 1)">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
            </div>
        </div>
    `;
  

    const track = document.getElementById(`${containerId}-track`);
    items.forEach(item => {
        const carouselItem = document.createElement('div');
        carouselItem.className = 'carousel-item';
        carouselItem.innerHTML = `
            <div class="card">
                <img src="${item.snippet.thumbnails.medium.url}" class="thumbnail"
                     data-video-id="${item.id.videoId}"
                     data-title="${escapeHtml(item.snippet.title)}"
                     data-thumbnail="${item.snippet.thumbnails.medium.url}">
                <div class="carousel-overlay">
                    <h3>${escapeHtml(item.snippet.title)}</h3>
                    <p>${escapeHtml(item.snippet.channelTitle)}</p>
                </div>
            </div>
        `;
        track.appendChild(carouselItem);
    });

    // Attach click event to thumbnails
    track.querySelectorAll('.carousel-item').forEach(item => {
  const thumb = item.querySelector('.thumbnail');
  const videoId = thumb?.getAttribute('data-video-id');

  item.addEventListener('click', () => {
    console.log('Item clicked, videoId:', videoId);
    if (videoId) {
  openVideoInPlayer(videoId);

    } else {
      console.error('Still no videoId. At this point, question your life choices.');
    }
  });
});
    

    startAutoScroll(containerId);
}
    let carouselIntervals = {};

    function startAutoScroll(containerId) {
        if (carouselIntervals[containerId]) {
            clearInterval(carouselIntervals[containerId]);
        }

        carouselIntervals[containerId] = setInterval(() => {
            moveCarousel(containerId, 1);
        }, 5000);
    }

    function moveCarousel(containerId, direction) {
        const track = document.getElementById(`${containerId}-track`);
        if (!track) return;

        const items = track.querySelectorAll('.carousel-item');
        if (items.length === 0) return;

        const itemWidth = items[0].offsetWidth + 20;
        const currentPosition = track.style.transform ?
            parseInt(track.style.transform.split('(')[1].split('px')[0]) : 0;

        let newPosition = currentPosition - (itemWidth * direction);
        const maxPosition = -(itemWidth * (items.length - 4));

        if (newPosition > 0) {
            newPosition = maxPosition;
        } else if (newPosition < maxPosition) {
            newPosition = 0;
        }

        track.style.transform = `translateX(${newPosition}px)`;
        startAutoScroll(containerId);
    }

// ðŸ‘‡ expose it to inline onclick move carouel
window.moveCarousel = moveCarousel;


    function displayExploreContent() {
        const trailerDiv = document.getElementById('trailerResults');
        const movieDiv = document.getElementById('moviesResults');
        const animeDiv = document.getElementById('animeResults');

        trailerDiv.innerHTML = '';
        movieDiv.innerHTML = '';
        animeDiv.innerHTML = '';

        if (trailerResults.length === 0) {
            trailerDiv.innerHTML = `<div class="empty-state"><i class="fas fa-film"></i><p>No trailers found</p></div>`;
        } else {
            trailerResults.slice(0, 30).forEach((video, index) => {
                trailerDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (movieResults.length === 0) {
            movieDiv.innerHTML = `<div class="empty-state"><i class="fas fa-video"></i><p>No movies found</p></div>`;
        } else {
            movieResults.slice(0, 30).forEach((video, index) => {
                movieDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        if (animeResults.length === 0) {
            animeDiv.innerHTML = `<div class="empty-state"><i class="fas fa-dragon"></i><p>No anime found</p></div>`;
        } else {
            animeResults.slice(0, 20).forEach((video, index) => {
                animeDiv.appendChild(generateVideoCard(video, index < 3));
            });
        }

        document.getElementById('explorePagination').style.display = 'none';
    }

 function generateVideoCard(video, isTrending = false, index = 0) {
    const card = document.createElement('div');
    card.className = 'card';

    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const isFavorited = favorites.some(fav => fav.videoId === video.id.videoId);

    card.innerHTML = `
        ${isTrending ? '<span class="trending-badge">Trending</span>' : ''}
        <button class="favorite-btn ${isFavorited ? 'active' : ''}"
                data-video-id="${video.id.videoId}"
                data-title="${escapeHtml(video.snippet.title)}"
                data-thumbnail="${video.snippet.thumbnails.medium.url}">
            <i class="fas fa-heart"></i>
        </button>
        <img src="${video.snippet.thumbnails.medium.url}" class="thumbnail"
             data-video-id="${video.id.videoId}"
             data-title="${escapeHtml(video.snippet.title)}"
             data-thumbnail="${video.snippet.thumbnails.medium.url}">
        <div class="card-content">
            <div class="video-title">${escapeHtml(video.snippet.title)}</div>
            <div class="channel">${escapeHtml(video.snippet.channelTitle)}</div>
            <div class="card-stats">
                <div class="views-count">
                    <i class="fas fa-eye"></i> ${Math.floor(Math.random() * 10000000).toLocaleString()}
                </div>
                <div class="likes-count">
                    <i class="fas fa-heart"></i> ${Math.floor(Math.random() * 500000).toLocaleString()}
                </div>
            </div>
        </div>
    `;

    // Create a wrapper div to hold the card (no ad by default)
    const wrapper = document.createElement('div');
    wrapper.className = 'card-wrapper';
    wrapper.appendChild(card);

    // Add event listeners
    card.querySelector('.thumbnail').addEventListener('click', () => {
        playVideo(video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
    });
    card.querySelector('.favorite-btn').addEventListener('click', (e) => {
        toggleFavorite(e, video.id.videoId, escapeHtml(video.snippet.title), video.snippet.thumbnails.medium.url);
    });

    return wrapper;
}


    async function fetchForYouContent() {
        const user = auth.currentUser;
        if (!user) return;

        const preferences = JSON.parse(localStorage.getItem('userPreferences'));
        if (!preferences || !preferences.contentType) return;

        showLoading(true);
        try {
            const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${encodeURIComponent(preferences.contentType + ' trailer OR full movie')}&type=video&key=${getApiKey()}`);
            const data = await response.json();
            if (data.error) {
                if (data.error.code === 403) {
                    switchApiKey();
                    return fetchForYouContent();
                }
                throw new Error(data.error.message);
            }

saveToCache('cachedForYouResults', data.items);

            const forYouDiv = document.getElementById('forYouResults');
            forYouDiv.innerHTML = '';
            document.getElementById('forYouSection').style.display = 'block';

            data.items.forEach((video, index) => {
                forYouDiv.appendChild(generateVideoCard(video, index < 3));
            });
        } catch (error) {
            showError(`Failed to load For You content: ${error.message}`);
            console.error('Error fetching For You:', error);
        } finally {
            showLoading(false);
        }
    }

    async function searchContent() {
    const query = document.getElementById('search').value.trim();
    if (!query) return;

    saveToHistory(query, "");
    let searches = JSON.parse(localStorage.getItem('searchCount')) || 0;
    searches += 1;
    localStorage.setItem('searchCount', JSON.stringify(searches));

    if (document.getElementById('mePage').classList.contains('active')) {
        updateMeTabStats();
    }

    showLoading(true);
    try {
        const trailerResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=30&q=${encodeURIComponent(query + ' trailer')}&type=video&key=${getApiKey()}`);
        const trailerData = await trailerResponse.json();
        if (trailerData.error) {
            if (trailerData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(trailerData.error.message);
        }

        const movieResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=30&q=${encodeURIComponent(query + ' full movie -trailer')}&type=video&videoDuration=long&key=${getApiKey()}`);
        const movieData = await movieResponse.json();
        if (movieData.error) {
            if (movieData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(movieData.error.message);
        }

        const animeResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=20&q=${encodeURIComponent(query + ' anime trailer OR full movie')}&type=video&key=${getApiKey()}`);
        const animeData = await animeResponse.json();
        if (animeData.error) {
            if (animeData.error.code === 403) {
                switchApiKey();
                return searchContent();
            }
            throw new Error(animeData.error.message);
        }

        const movieVideoIds = movieData.items.map(item => item.id.videoId).join(',');
        const movieDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${movieVideoIds}&key=${getApiKey()}`);
        const movieDetailsData = await movieDetailsResponse.json();
        const fullMovies = movieData.items.map(item => ({
            ...item,
            contentDetails: movieDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));

        const animeVideoIds = animeData.items.map(item => item.id.videoId).join(',');
        const animeDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${animeVideoIds}&key=${getApiKey()}`);
        const animeDetailsData = await animeDetailsResponse.json();
        const fullAnime = animeData.items.map(item => ({
            ...item,
            contentDetails: animeDetailsData.items.find(detail => detail.id === item.id.videoId)?.contentDetails
        }));

        exploreTotalResults = [
            ...trailerData.items,
            ...fullMovies.filter(isFullLengthVideo),
            ...fullAnime.filter(video => isFullLengthVideo(video) && isAnimeRelated(video))
        ].sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));

        // Cache search results with timestamp
        saveToCache('cachedSearchResults', exploreTotalResults);
        saveToCache('cachedSearchPage', exploreCurrentPage);

        exploreCurrentPage = 0;
        displaySearchResults();
        updatePagination();
        saveToHistory(query, exploreTotalResults[0]?.snippet?.thumbnails?.medium?.url || '');
    } catch (error) {
        showError(`Failed to search: ${error.message}`);
        console.error('Search error:', error);
    } finally {
        showLoading(false);
    }
}


async function searchTVContent() {
  const query = document.getElementById('search').value.trim();
  if (!query) return;

  try {
    const response = await fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&api_key=${API_KEY}`);
    const data = await response.json();

    const container = document.getElementById('trendingCarousel');
    container.innerHTML = '';

    renderMovieGrid(data.results, 'trendingCarousel');
  } catch (err) {
    console.error('TMDB search failed:', err);
    showError('Could not fetch movie results. Please try again.');
  }
}

async function searchTMDB(query) {
  try {
    const response = await fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&api_key=${API_KEY}`);
    const data = await response.json();

    const container = document.getElementById('trendingCarousel');
    container.innerHTML = '';

    renderMovieGrid(data.results, 'trendingCarousel'); // existing render function
  } catch (err) {
    console.error('TMDB search failed:', err);
    showError('TMDB search failed. Try again.');
  }
}

    function handleKeyPress(event) {
        if (event.key === 'Enter') {
            searchContent();
        }
    }

    function displaySearchResults() {
    const searchDiv = document.getElementById('searchResults');
    const contentDiv = document.getElementById('exploreContent');
    searchDiv.innerHTML = '';

    if (exploreTotalResults.length === 0) {
        searchDiv.innerHTML = `<div class="empty-state"><i class="fas fa-compass"></i><p>No results found</p></div>`;
        contentDiv.style.display = 'none';
        searchDiv.style.display = 'block';
        document.getElementById('explorePagination').style.display = 'none';
        return;
    }

    contentDiv.style.display = 'none';
    searchDiv.style.display = 'block';

    const start = exploreCurrentPage * resultsPerPage;
    const end = start + resultsPerPage;
    const videos = exploreTotalResults.slice(start, end);

    videos.forEach((video, index) => {
        // Add movie card
        searchDiv.appendChild(generateVideoCard(video, index < 3, index));

        // Add Adsterra banners with labels
        const addBanner = (bannerId, scriptSrc) => {
            // Add banner container
            const adDiv = document.createElement('div');
            adDiv.className = 'adsterra-banner';
            adDiv.id = bannerId;
            adDiv.style.position = 'relative'; // Enable absolute positioning for label

            // Add ad label
            const adLabel = document.createElement('div');
            adLabel.className = 'ad-label';
            adLabel.textContent = 'AD';
            adDiv.appendChild(adLabel); // Label inside banner container

            // Add banner script
            const adScript = document.createElement('script');
            adScript.async = true;
            adScript.setAttribute('data-cfasync', 'false');
            adScript.src = scriptSrc;
            adScript.onerror = () => {
                console.error('Failed to load Adsterra script for ID:', adDiv.id);
                adDiv.style.display = 'none';
            };
            adDiv.appendChild(adScript);
            searchDiv.appendChild(adDiv);
        };

    });

    document.getElementById('explorePagination').style.display = 'flex';
    
}

    
    function isFullLengthVideo(video) {
        const duration = video.contentDetails?.duration;
        if (!duration) return false;

        const regex = /PT(\d+H)?(\d+M)?(\d+S)?/;
        const matches = duration.match(regex);
        if (!matches) return false;

        const hours = parseInt(matches[1]) || 0;
        const minutes = parseInt(matches[2]) || 0;
        const seconds = parseInt(matches[3]) || 0;
        const totalSeconds = hours * 3600 + minutes * 60 + seconds;

        return totalSeconds >= 60;
    }

    
    function sortItemsByPublishedDate(items) {
        return items.sort((a, b) => new Date(b.snippet.publishedAt) - new Date(a.snippet.publishedAt));
    }

 function playVideo(videoId, title, thumbnail) {
  // Save to watch history
  let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
  watchHistory.unshift({ videoId, title, thumbnail, date: new Date().toISOString() });
  localStorage.setItem('watchHistory', JSON.stringify(watchHistory));

  // Open in player tab (no reload)
  openVideoInPlayer(videoId);
}

    function saveToHistory(query, thumbnail) {
        let history = JSON.parse(localStorage.getItem('searchHistory')) || [];
        history = history.filter(item => item.query.toLowerCase() !== query.toLowerCase());
        history.unshift({ query, thumbnail, date: new Date().toISOString() });
        if (history.length > 10) {
            history = history.slice(0, 10);
        }
        localStorage.setItem('searchHistory', JSON.stringify(history));
    }

    function showAuthModal() {
        document.getElementById('authModal').style.display = 'block';
    }

    function closeAuthModal() {
        document.getElementById('authModal').style.display = 'none';
    }

    function toggleAuthMode() {
    isSignUpMode = !isSignUpMode;
    document.getElementById('authModalTitle').textContent = isSignUpMode ? 'Join TUBE TRAILER Today!' : 'Welcome Back!';
    document.getElementById('authModalBlurb').textContent = isSignUpMode ? 'Unlock personalized content and premium features.' : 'Access your personalized content and settings.';
    document.getElementById('authSubmitBtn').textContent = isSignUpMode ? 'Sign Up' : 'Login';
    document.getElementById('authToggleText').textContent = isSignUpMode ? 'Login' : 'Sign Up';
    const contentPreferences = document.getElementById('contentPreferences');
    contentPreferences.style.display = isSignUpMode ? 'block' : 'none';
    contentPreferences.required = isSignUpMode; // Toggle required attribute
    document.getElementById('authError').style.display = 'none';
}

    function showAccountModal() {
    const user = auth.currentUser;
    if (user) {
        const preferences = JSON.parse(localStorage.getItem('userPreferences')) || {};
        const contentSelect = document.getElementById('accountContentPreferences');
        contentSelect.value = preferences.contentType || '';
        document.getElementById('accountModal').style.display = 'block';
    } else {
        showAuthModal();
    }
}

    function closeModal() {
        document.getElementById('accountModal').style.display = 'none';
    }

    async function saveAccount(event) {
    event.preventDefault();
    try {
        const contentType = document.getElementById('accountContentPreferences').value;
        if (!contentType) {
            showError('Please select a content type.');
            return;
        }

        localStorage.setItem('userPreferences', JSON.stringify({ contentType }));
        showNotificationModal('Preferences updated successfully!');
        closeModal();

        // Refresh personalized content
        const currentPage = document.querySelector('.page.active').id;
        if (currentPage === 'explorePage') {
            await fetchForYouContent();
        } else if (currentPage === 'shortsPage') {
            await fetchShortsContent();
        }
    } catch (error) {
        showError(`Error saving preferences: ${error.message}`);
        console.error('Save account error:', error);
    }
}

    function signOut() {
        firebaseSignOut(auth).then(() => {
            localStorage.removeItem('userPreferences');
            document.getElementById('forYouSection').style.display = 'none';
            updateUserStatus();
            showToast('Signed out successfully');
            showAuthModal();
        }).catch(error => {
            showError(`Sign out failed: ${error.message}`);
            console.error('Sign out error:', error);
        });
    }

    function updateUserStatus() {
    const user = auth.currentUser;
    const statusElement = document.getElementById('userStatus');
    const nameElement = document.getElementById('userProfileName');
    const avatarImg = document.getElementById('userAvatarImg');

    if (user && user.email) {
        const emailPrefix = user.email.split('@')[0];
        nameElement.textContent = user.displayName || emailPrefix || 'User';
        statusElement.textContent = 'Premium Member';
        avatarImg.src = user.photoURL || 'https://via.placeholder.com/100';
    } else {
        nameElement.textContent = 'Guest User';
        statusElement.textContent = 'Basic Member';
        avatarImg.src = 'https://via.placeholder.com/100';
    }

    // Update stats in stats-grid
    updateMeTabStats();
}

// Profile header event listeners
document.getElementById('userAvatarImg').addEventListener('click', () => {
    if (auth.currentUser) {
        showAccountModal();
    } else {
        showAuthModal();
    }
});

document.getElementById('editProfileBtn').addEventListener('click', () => {
    if (auth.currentUser) {
        showAccountModal();
    } else {
        showAuthModal();
    }
});

    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.remove('light-mode');
            document.body.classList.add('dark-mode');
            localStorage.setItem('themePreference', 'dark');
        } else {
            document.body.classList.remove('dark-mode');
            document.body.classList.add('light-mode');
            localStorage.setItem('themePreference', 'light');
        }
    }


    function toggleTheme() {
        const isLight = document.body.classList.contains('light-mode');
        setTheme(isLight ? 'dark' : 'light');
        showToast(`Switched to ${isLight ? 'Dark' : 'Light'} Mode`);
    }

    function showNotificationModal() {
        document.getElementById('notificationModal').style.display = 'block';
    }

    function hideNotificationModal() {
        document.getElementById('notificationModal').style.display = 'none';
    }

    function showAboutModal() {
        document.getElementById('aboutModal').style.display = 'block';
    }

    function hideAboutModal() {
    const aboutModal = document.getElementById('aboutModal');
    if (aboutModal) {
        aboutModal.style.display = 'none';
    } else {
        console.warn('About modal element not found');
    }
}

    function clearAllCache() {
        Object.keys(localStorage).forEach(key => {
            if (key.startsWith('preload-') || key.includes('Trending') || key.includes('Results')) {
                localStorage.removeItem(key);
            }
        });
        location.reload();
    }

    function updateMeTabStats() {
    const watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
    const meWatchHistoryCount = document.getElementById('meWatchHistoryCount');
    if (meWatchHistoryCount) {
        meWatchHistoryCount.textContent = watchHistory.length;
    }

    const searchCount = JSON.parse(localStorage.getItem('searchCount')) || 0;
    const meSearchHistoryCount = document.getElementById('meSearchHistoryCount');
    if (meSearchHistoryCount) {
        meSearchHistoryCount.textContent = searchCount;
    }
}

   /* event listener auth form*/ document.getElementById('authForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('authEmail').value;
    const password = document.getElementById('authPassword').value;
    const preferences = document.getElementById('contentPreferences').value;

    try {
        if (isSignUpMode) {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            console.log('User signed up:', userCredential.user);
            localStorage.setItem('userPreferences', JSON.stringify({ contentType: preferences }));
            showToast('Account created successfully!');
        } else {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            console.log('User logged in:', userCredential.user);
            showToast('Logged in successfully!');
        }
        
        const dontShowAgain = document.getElementById('dontShowAuthCheckbox').checked;
localStorage.setItem('skipAuthModal', dontShowAgain ? 'true' : 'false');
        closeAuthModal();
        updateUserStatus();
        fetchForYouContent();
    } catch (error) {
        console.error('Auth error:', error);
        const errorMessages = {
            'auth/invalid-credential': 'Invalid password or email.',
            'auth/invalid-email': 'Please enter a valid email address.',
            'auth/user-not-found': 'Invalid password or email.',
            'auth/wrong-password': 'Invalid password or email.',
            'auth/email-already-in-use': 'This email is already registered. Please log in.',
            'auth/weak-password': 'Password must be at least 6 characters long.',
            'auth/missing-password': 'Please enter a password.',
            'auth/missing-email': 'Please enter an email address.'
        };
        const customMessage = errorMessages[error.code] || 'An error occurred. Please try again.';
        showAuthError(customMessage);
    }
});
    onAuthStateChanged(auth, (user) => {
    console.log('Auth state changed:', user ? user.email : 'No user');
    updateUserStatus();

    // Only show modal if the user is definitely not logged in
    if (!user) {
        // Check if "don't show again" was checked
        const skipAuthModal = localStorage.getItem('skipAuthModal');
        if (skipAuthModal !== 'true') {
            showAuthModal();
        }
  } else {
    const cachedForYouResults = loadFromCache('cachedForYouResults') || [];
    if (cachedForYouResults.length > 0) {
        const forYouDiv = document.getElementById('forYouResults');
        forYouDiv.innerHTML = '';
        cachedForYouResults.forEach((video, index) => {
            forYouDiv.appendChild(generateVideoCard(video, index < 3));
        });
        document.getElementById('forYouSection').style.display = 'block';
        console.log('[âœ… CACHE] Loaded For You from cache');
    } else {
        fetchForYouContent();
    }
}
});

   //Dom content document.addEventListener('DOMContentLoaded', () => {
    const savedTheme = localStorage.getItem('themePreference') || 'dark';
    setTheme(savedTheme);
    updateUserStatus();

    // Load cached results with expiration check
    const cachedTrailerResults = loadFromCache('cachedTrailerResults') || [];
    const cachedMovieResults = loadFromCache('cachedMovieResults') || [];
    const cachedAnimeResults = loadFromCache('cachedAnimeResults') || [];
    const cachedSearchResults = loadFromCache('cachedSearchResults') || [];
    const cachedSearchPage = loadFromCache('cachedSearchPage') || 0;

    if (cachedTrailerResults.length > 0 && cachedMovieResults.length > 0 && cachedAnimeResults.length > 0) {
        console.log('Loading cached explore results from localStorage:', {
            trailerResults: cachedTrailerResults.length + ' items',
            movieResults: cachedMovieResults.length + ' items',
            animeResults: cachedAnimeResults.length + ' items'
        });
        trailerResults = cachedTrailerResults;
        movieResults = cachedMovieResults;
        animeResults = cachedAnimeResults;
        displayExploreContent();
        createExploreCarousel();
        fetchForYouContent();
    } else {
        console.log('No valid cached explore results found or cache expired. Fetching new content.');
        fetchExploreContent();
    }

    if (cachedSearchResults.length > 0) {
        console.log('Loading cached search results from localStorage:', {
            searchResults: cachedSearchResults.length + ' items',
            searchPage: cachedSearchPage
        });
        exploreTotalResults = cachedSearchResults;
        exploreCurrentPage = cachedSearchPage;
        displaySearchResults();
        
    } else {
        console.log('No valid cached search results found or cache expired.');
    }

    // Search input event listeners
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('focus', showSearchHistory);
    searchInput.addEventListener('blur', hideSearchHistory);
    searchInput.addEventListener('input', filterSearchHistory);
    searchInput.addEventListener('keypress', handleKeyPress);

    // Button event listeners
    document.getElementById('searchBtn').addEventListener('click', searchContent);
    document.addEventListener('DOMContentLoaded', () => {
  const reloadBtn = document.getElementById('reloadBtn');
  if (reloadBtn) {
    reloadBtn.addEventListener('click', () => {
      Object.keys(localStorage).forEach(key => {
        if (
          key.startsWith('preload-') ||
          key.includes('Trending') ||
          key.includes('Results')
        ) {
          localStorage.removeItem(key);
        }
      });

      location.hash = '#explorePage';
      showPage('explorePage');
      fetchExploreContent();
    });
  } else {
    console.warn('âš ï¸ reloadBtn not found in DOM.');
  }
});
    // Navigation event listeners
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const pageId = item.getAttribute('data-page');
            if (pageId) {
                showPage(pageId);
            }
        });
    });

    // Auth modal event listeners
    document.getElementById('cancelAuthBtn').addEventListener('click', closeAuthModal);
    document.getElementById('toggleAuthBtn').addEventListener('click', toggleAuthMode);

    // Account modal event listeners
    document.getElementById('accountForm').addEventListener('submit', saveAccount);
    document.getElementById('cancelAccountBtn').addEventListener('click', closeModal);
    document.getElementById('signOutBtn').addEventListener('click', signOut);

    // Settings event listeners
    document.getElementById('accountBtn').addEventListener('click', showAccountModal);
    document.getElementById('themeBtn').addEventListener('click', toggleTheme);
    document.getElementById('notificationBtn').addEventListener('click', showNotificationModal);
    document.getElementById('aboutBtn').addEventListener('click', showAboutModal);

    // Notification and About modal event listeners
document.getElementById('closeNotificationBtn').addEventListener('click', hideNotificationModal);
document.getElementById('closeAboutBtn')?.addEventListener('click', hideAboutModal);

    // Modal close on outside click
 window.addEventListener('click', (event) => {
    const authModal = document.getElementById('authModal');
    const accountModal = document.getElementById('accountModal');
    const notificationModal = document.getElementById('notificationModal');
    const aboutModal = document.getElementById('aboutModal');
    if (event.target === authModal) {
        closeAuthModal();
    }
    if (event.target === accountModal) {
        closeModal();
    }
    if (event.target === notificationModal) {
        hideNotificationModal();
    }
    if (event.target === aboutModal) {
        hideAboutModal();
    }
});

    // Persist last search
    const lastSearch = localStorage.getItem('lastSearch');
    if (lastSearch) {
        searchInput.value = lastSearch;
    }
    searchInput.addEventListener('input', (e) => {
        localStorage.setItem('lastSearch', e.target.value);
    });


// Initialize player when page loads
document.addEventListener('DOMContentLoaded', function() {
    // Get video ID from URL
    const query = new URLSearchParams(window.location.search);
    const videoId = query.get('v');
    
    if (videoId) {
        // Load main video
        ytPlayer.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0&modestbranding=1&controls=1&showinfo=0&playsinline=1&enablejsapi=1`;
        
        // Initialize buttons
        initButtons();
        
        // Fetch video info
        fetchVideoDetails(videoId);
        
        // Fetch related videos
        fetchRelatedVideos(videoId);
        
        // Show player page
        showPage('playerPage');
    }
});

// Format numbers (1000 -> 1K, 1000000 -> 1M)
function formatNumber(num) {
    if (!num) return '0';
    num = parseInt(num);
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    }
    if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}

function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diffInDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
    
    if (diffInDays === 0) return 'Today';
    if (diffInDays === 1) return 'Yesterday';
    if (diffInDays < 7) return `${diffInDays} days ago`;
    if (diffInDays < 30) return `${Math.floor(diffInDays / 7)} weeks ago`;
    if (diffInDays < 365) return `${Math.floor(diffInDays / 30)} months ago`;
    return `${Math.floor(diffInDays / 365)} years ago`;
}

// Button initialization
function initButtons() {
    // Subscribe button always shows "Subscribed"
    const subscribeBtn = document.querySelector('.subscribe-btn');
    subscribeBtn.textContent = 'Subscribed';
    subscribeBtn.style.backgroundColor = 'var(--button-bg)';
    subscribeBtn.style.color = 'var(--text-secondary)';
     
    
}


// Fetch video details from YouTube API
async function fetchVideoDetails(videoId) {
  // âœ… DOM references â€” must be defined first
  const videoTitle = document.getElementById('videoTitle');
  const channelName = document.getElementById('channelName');
  const uploadDate = document.getElementById('uploadDate');
  const viewCount = document.getElementById('viewCount');
  const likeCount = document.getElementById('likeCount');

  try {
    // âœ… Fetch video details using key rotation
    const data = await fetchWithRotation(
      `https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key={API_KEY}`
    );

    if (!data || !data.items || data.items.length === 0) {
      videoTitle.textContent = "Video not found.";
      return;
    }

    const video = data.items[0];
    const snippet = video.snippet;
    const stats = video.statistics;

    // âœ… Inject video data into DOM
    videoTitle.textContent = snippet.title;
    channelName.textContent = snippet.channelTitle;
    uploadDate.textContent = formatDate(snippet.publishedAt);
    viewCount.textContent = formatNumber(stats.viewCount) + " views";
    likeCount.textContent = formatNumber(stats.likeCount);

    // âœ… Save to watch history (optional)
    const thumbnail = snippet.thumbnails.medium.url;
    let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
    watchHistory.unshift({
      videoId,
      title: snippet.title,
      thumbnail,
      date: new Date().toISOString()
    });
    localStorage.setItem('watchHistory', JSON.stringify(watchHistory));

    // âœ… Fetch channel info
    fetchChannelDetails(snippet.channelId);
  } catch (err) {
    console.error("Error loading video details:", err);
    videoTitle.textContent = "Error loading video.";
  }
}

// Fetch channel details
async function fetchChannelDetails(channelId) {
  // âœ… DOM references must be defined
  const channelAvatar = document.getElementById('channelAvatar');
  const channelSubs = document.getElementById('channelSubs');
  const subscribeBtn = document.getElementById('subscribeBtn');

  try {
    const data = await fetchWithRotation(
      `https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&id=${channelId}&key={API_KEY}`
    );

    if (!data || !data.items || data.items.length === 0) {
      console.warn("No channel data found.");
      return;
    }

    const channel = data.items[0];
    const snippet = channel.snippet;
    const stats = channel.statistics;

    // âœ… Display channel avatar and subscriber count
    channelAvatar.src = snippet.thumbnails.default.url;
    channelSubs.textContent = formatNumber(stats.subscriberCount) + " subscribers";

    // âœ… Handle subscribe button toggle state
    const isSubbed = localStorage.getItem(`subbed_${channelId}`) === "true";
    subscribeBtn.textContent = isSubbed ? "Subscribed" : "Subscribe";

    subscribeBtn.onclick = () => {
      localStorage.setItem(`subbed_${channelId}`, "true");
      subscribeBtn.textContent = "Subscribed";
    };
  } catch (err) {
    console.error("Error loading channel details:", err);
  }
}

// Fetch related videos
async function fetchRelatedVideos(videoId) {
  const relatedVideosGrid = document.getElementById('relatedVideosGrid');
  if (!relatedVideosGrid) {
    console.warn('Missing #relatedVideosGrid element');
    return;
  }

  try {
    const data = await fetchWithRotation(
      `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&relatedToVideoId=${videoId}&maxResults=12&key={API_KEY}`
    );

    if (!data || !data.items) {
      console.warn('No related videos found');
      return;
    }

    relatedVideosGrid.innerHTML = ''; // Clear previous results

    data.items.forEach((item) => {
      const vId = item.id.videoId;
      const v = item.snippet;

      const div = document.createElement('div');
      div.className = 'video-card';
      div.innerHTML = `
        <img src="${v.thumbnails.medium.url}" alt="${v.title}" onclick="openVideoInPlayer('${vId}')">
        <div class="video-info">
          <h3>${v.title}</h3>
          <p>${v.channelTitle}</p>
        </div>
      `;
      relatedVideosGrid.appendChild(div);
    });
  } catch (err) {
    console.error('Error loading related videos:', err);
  }
}


// Display related videos
function displayRelatedVideos(videos) {
    relatedVideosGrid.innerHTML = '';
    
    videos.forEach(video => {
        const videoId = video.id.videoId || video.id;
        const snippet = video.snippet;
        
        const videoCard = document.createElement('div');
        videoCard.className = 'video-card';
        videoCard.onclick = () => {
            window.location.href = `?v=${videoId}`;
        };
        
        videoCard.innerHTML = `
            <img src="${snippet.thumbnails.medium.url}" class="video-thumbnail" alt="${snippet.title}">
            <div class="video-details">
                <div class="video-card-title">${snippet.title}</div>
                <div class="video-card-channel">${snippet.channelTitle}</div>
            </div>
        `;
        
        relatedVideosGrid.appendChild(videoCard);
    });
}

// Fallback to popular videos
async function fetchPopularVideos() {
    try {
        const response = await fetchWithRotation(
            `https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=10&key=${API_KEYS[currentApiKeyIndex]}`
        );
        
        if (response.items && response.items.length > 0) {
            displayRelatedVideos(response.items);
        }
    } catch (error) {
        console.error('Error fetching popular videos:', error);
    }
}


async function openVideoInPlayer(videoId) {
  // Show the player tab
  switchTab('playerPage');

  // Scroll to top
  window.scrollTo({ top: 0 });

  // Load video into iframe
  const iframe = document.getElementById('ytplayer');
  iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&rel=0&modestbranding=1&controls=1&playsinline=1&enablejsapi=1`;

  // âœ… Just call your unified logic
 
 fetchPopularVideos(); fetchVideoDetails(videoId);
  fetchRelatedVideos(videoId);
}

// Save to watch history
function saveToWatchHistory(video) {
    const watched = JSON.parse(localStorage.getItem('watchedVideos')) || [];
    const existingIndex = watched.findIndex(v => v.id === video.id);
    
    if (existingIndex !== -1) {
        watched.splice(existingIndex, 1);
    }
    
    watched.unshift({
        id: video.id,
        title: video.snippet.title,
        thumbnail: `https://img.youtube.com/vi/${video.id}/mqdefault.jpg`,
        url: `?v=${video.id}`
    });
    
    localStorage.setItem('watchedVideos', JSON.stringify(watched.slice(0, 20)));
}

// API request with retry logic
async function fetchWithRotation(urlTemplate) {
  const totalKeys = API_KEYS.length;
  let attempts = 0;

  while (attempts < totalKeys) {
    const apiKey = API_KEYS[currentApiKeyIndex];
    const url = urlTemplate.replace('{API_KEY}', apiKey);

    try {
      const response = await fetch(url);
      if (response.ok) {
        const data = await response.json();
        return data;
      } else {
        console.warn(`API key index ${currentApiKeyIndex} failed: ${response.status}`);
      }
    } catch (err) {
      console.error(`API key index ${currentApiKeyIndex} threw an error`, err);
    }

    // Move to next key
    currentApiKeyIndex = (currentApiKeyIndex + 1) % totalKeys;
    attempts++;
  }

  // After trying all keys
  throw new Error("All API keys failed");
}




function savePageState() {
    const pageState = {
        videoTitle: document.getElementById('videoTitle').textContent,
        viewCount: document.getElementById('viewCount').textContent,
        uploadDate: document.getElementById('uploadDate').textContent,
        likeCount: document.getElementById('likeCount').textContent,
        channelName: document.getElementById('channelName').textContent,
        channelSubs: document.getElementById('channelSubs').textContent,
        channelAvatar: document.getElementById('channelAvatar').src,
        videoId: new URLSearchParams(window.location.search).get('v')
    };
    localStorage.setItem('savedPageState', JSON.stringify(pageState));
}

function restorePageState() {
    const savedState = localStorage.getItem('savedPageState');
    if (savedState) {
        const state = JSON.parse(savedState);
        document.getElementById('videoTitle').textContent = state.videoTitle;
        document.getElementById('viewCount').textContent = state.viewCount;
        document.getElementById('uploadDate').textContent = state.uploadDate;
        document.getElementById('likeCount').textContent = state.likeCount;
        document.getElementById('channelName').textContent = state.channelName;
        document.getElementById('channelSubs').textContent = state.channelSubs;
        document.getElementById('channelAvatar').src = state.channelAvatar;
    }
}

function checkForDownloadError() {
    restorePageState();
    
    // Check if we should show error message
    if (localStorage.getItem('showDownloadError') === 'true' && 
        sessionStorage.getItem('justReturned') === 'true') {
        
        // Small delay for better UX
        setTimeout(() => {
            document.getElementById('downloadError').style.display = 'block';
        }, 300);
        
        // Clear flags
        localStorage.removeItem('showDownloadError');
        sessionStorage.removeItem('justReturned');
    }
    
    // Clean up
    localStorage.removeItem('savedPageState');
}
           
// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    checkForDownloadError();
    
    // Ad toggle functionality
    const adDropDown = document.getElementById("adDropDown");
    const toggleIcon = document.getElementById("toggleIcon");

    document.getElementById("toggleAd").addEventListener("click", function() {
        const isVisible = adDropDown.style.display !== "none";

        if (isVisible) {
            adDropDown.style.display = "none";
            toggleIcon.classList.remove("fa-chevron-up");
            toggleIcon.classList.add("fa-chevron-down");
        } else {
            adDropDown.style.display = "block";
            toggleIcon.classList.remove("fa-chevron-down");
            toggleIcon.classList.add("fa-chevron-up");
        }
    });
});

</script>

<script>
  // Show page by hash on load Lets the other pages link to this one
  window.addEventListener('DOMContentLoaded', function () {
    const hash = window.location.hash;
    const pages = document.querySelectorAll('.page');
    const navItems = document.querySelectorAll('.nav-item');

    if (hash) {
      pages.forEach(page => {
        page.classList.remove('active');
        if ('#' + page.id === hash) {
          page.classList.add('active');
        }
      });

      navItems.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href') === hash) {
          link.classList.add('active');
        }
      });
    }
  });

  // Update hash on nav click (optional if not already handled)
  document.querySelectorAll('.bottom-nav .nav-item').forEach(link => {
    link.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if (href.startsWith('#')) {
        e.preventDefault();
        window.location.hash = href;
        window.dispatchEvent(new Event('DOMContentLoaded'));
      }
    });
  });
  
function switchTab(tabId) {

  // Hide live search results whenever switching tabs
  const liveSearchResults = document.getElementById('liveSearchResults');
  if (liveSearchResults) {
    liveSearchResults.style.display = 'none';
  }

  // ðŸ” Hide all tabs
  document.querySelectorAll('.page').forEach(tab => {
    tab.classList.remove('active');
  });
  // ðŸ” Hide all tabs
  document.querySelectorAll('.page').forEach(tab => {
    tab.classList.remove('active');
  });

  // âœ… Activate selected tab
  const activeTab = document.getElementById(tabId);
  if (activeTab) {
    activeTab.classList.add('active');
  }

  // âœ… Toggle header visibility
  const header = document.querySelector('.header');
  if (header) {
    header.style.display = (tabId === 'tvPage') ? 'none' : 'flex';
  }

  // âœ… Pause YouTube player if leaving playerPage
  if (tabId !== 'playerPage') {
    const iframe = document.getElementById('ytplayer');
    if (iframe && iframe.contentWindow) {
      iframe.contentWindow.postMessage(JSON.stringify({
        event: "command",
        func: "pauseVideo",
        args: []
      }), "*");
    }
  }

  // âœ… Manage Watch Page logic
  const watchContent = document.getElementById("watchContent");
  const watchPlaceholder = document.getElementById("watchPlaceholder");

  if (tabId === 'watchPage') {
    const isEmpty = !watchContent || watchContent.innerHTML.trim() === "";

    if (isEmpty && watchPlaceholder) {
      // show placeholder
      watchPlaceholder.style.display = "block";
      watchContent.style.display = "none";

 watchContent.style.display = "block";
      

  if (tabId === 'tvPage') {
    loadTVSections();
  }
    }
  }
}
</script>
<script>
  function handlePageVisibility() {
    const hash = window.location.hash || '#explorePage';
    const searchBar = document.querySelector('.search-container');
    const hiddenPages = ['#mePage', '#downloadsPage', '#shortsPage'];

    // Toggle search bar visibility
    if (searchBar) {
        searchBar.style.display = hiddenPages.includes(hash) ? 'none' : 'flex';
    }

    // Toggle page visibility
    document.querySelectorAll('.page').forEach(page => {
        page.classList.toggle('active', '#' + page.id === hash);
    });

    // Toggle nav item active state
    document.querySelectorAll('.nav-item').forEach(link => {
        link.classList.toggle('active', link.getAttribute('href') === hash);
    });

   
document.addEventListener("DOMContentLoaded", function () {
    // Load content for specific pages
    const hash = location.hash;

    if (hash === '#explorePage') {
        const cachedTrailerResults = loadFromCache('cachedTrailerResults') || [];
        const cachedMovieResults = loadFromCache('cachedMovieResults') || [];
        const cachedAnimeResults = loadFromCache('cachedAnimeResults') || [];

        if (
            cachedTrailerResults.length > 0 &&
            cachedMovieResults.length > 0 &&
            cachedAnimeResults.length > 0
        ) {
            trailerResults = cachedTrailerResults;
            movieResults = cachedMovieResults;
            animeResults = cachedAnimeResults;
            displayExploreContent();
            createExploreCarousel();
            fetchForYouContent();
        } else {
            fetchExploreContent();
        }
    } else if (hash === '#shortsPage') {
        document.body.classList.add('shorts-open');
        fetchShortsContent();
    } else if (hash === '#downloadsPage') {
        renderDownloads();
    } else {
        document.body.classList.remove('shorts-open');
    }
});


    // Hide pagination on non-explore pages
    document.querySelectorAll('.pagination-container').forEach(p => {
        p.style.display = hash === '#explorePage' ? 'flex' : 'none';
    });
}

// Event listeners for page navigation
window.addEventListener('DOMContentLoaded', handlePageVisibility);
window.addEventListener('hashchange', handlePageVisibility);

// Update nav-item click handlers to use hash-based navigation
document.querySelectorAll('.nav-item').forEach(item => {
    item.addEventListener('click', (e) => {
        e.preventDefault();
        const pageId = item.getAttribute('data-page');
        if (pageId) {
            window.location.hash = pageId;
        }
    });
});


function autoScrollCarousel(carouselId, interval = 4000) {
  const carousel = document.getElementById(carouselId);
  if (!carousel) return;

  let index = 0;

  setInterval(() => {
    const cards = carousel.querySelectorAll('.movie-card');
    if (!cards.length) return;

    index = (index + 1) % cards.length;
    const scrollX = index * carousel.clientWidth * 0.8; // 80% width card

    carousel.scrollTo({
      left: scrollX,
      behavior: 'smooth'
    });
  }, interval);
}

document.addEventListener('DOMContentLoaded', () => {
  autoScrollCarousel('trendingCarousel', 5000);
});

//searchTMDB Live listener
document.getElementById('search').addEventListener('input', async function () {
  const query = this.value.trim();
  const activeTab = document.querySelector('.page.active')?.id;

  if (!query || activeTab !== 'tvPage') {
    hideLiveResults(); // Hide the modal if query is empty or wrong tab
    return;
  }

  await searchTMDBLive(query);
});

function hideLiveResults() {
  const container = document.getElementById('liveSearchResults');
  if (container) container.style.display = 'none';
}


document.addEventListener('click', function (e) {
  const searchBar = document.getElementById('search');
  const dropdown = document.getElementById('liveSearchResults');
  if (!searchBar.contains(e.target) && !dropdown.contains(e.target)) {
    hideLiveResults();
  }
});

async function searchTMDBLive(query) {
  try {
    // Search both movies and TV shows
    const [moviesRes, tvRes] = await Promise.all([
      fetch(`https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(query)}&api_key=${API_KEY}`),
      fetch(`https://api.themoviedb.org/3/search/tv?query=${encodeURIComponent(query)}&api_key=${API_KEY}`)
    ]);

    const moviesData = await moviesRes.json();
    const tvData = await tvRes.json();

    const container = document.getElementById('liveSearchResults');
    container.innerHTML = '';

    // Combine results with type indicators
    const allResults = [
      ...(moviesData.results?.map(item => ({ ...item, media_type: 'movie' })) || []),
      ...(tvData.results?.map(item => ({ ...item, media_type: 'tv' })) || [])
    ].sort((a, b) => b.popularity - a.popularity); // Sort by popularity

    if (allResults.length === 0) {
      container.innerHTML = '<p class="empty-state">No results found.</p>';
      container.style.display = 'block';
      return;
    }

    // Display combined results
    allResults.slice(0, 8).forEach(item => {
      const div = document.createElement('div');
      div.className = 'search-result-item';
      
      // Use TV-specific fields for TV shows
      const title = item.media_type === 'tv' ? item.name : item.title;
      const date = item.media_type === 'tv' ? item.first_air_date : item.release_date;
      
      div.innerHTML = `
        <img src="${item.poster_path ? `https://image.tmdb.org/t/p/w92${item.poster_path}` : 'placeholder-image-url'}" 
             alt="${title}" />
        <div>
          <div class="title">${title}</div>
          <div class="meta">
            ${date || 'N/A'} â€¢ 
            ${item.media_type === 'tv' ? 'TV' : 'Movie'} â€¢ 
            â­ ${item.vote_average?.toFixed(1) || '?'}
          </div>
        </div>
      `;
      
      div.onclick = () => {
        if (item.media_type === 'tv') {
          openTVSeries(item.id);
        } else {
          openWatchPageWithContent(item.id);
        }
      };
      
      container.appendChild(div);
    });

    container.style.display = 'block';
  } catch (err) {
    console.error('Live search failed:', err);
    hideLiveResults();
  }
}

//Exit Tvmovies tab
function exitTo(tabId) {
  // Switch to the requested tab
  switchTab(tabId);

  // Optional: Reset the player area (optional cleanup)
  const watchContent = document.getElementById('watchContent');
  const placeholder = document.getElementById('watchPlaceholder');

  if (watchContent) watchContent.style.display = 'none';
  if (placeholder) placeholder.style.display = 'block';

  // Optional: clear player content if needed
  watchContent.innerHTML = '';
}

async function openTVSeries(tvId) {
  try {
    switchTab('watchPage');

    const placeholder = document.getElementById('watchPlaceholder');
    const watchContent = document.getElementById('watchContent');
    if (placeholder) placeholder.style.display = 'none';
    if (watchContent) watchContent.style.display = 'block';

    const [seriesRes, providersRes] = await Promise.all([
      fetch(`https://api.themoviedb.org/3/tv/${tvId}?api_key=${API_KEY}`),
      fetch(`https://api.themoviedb.org/3/tv/${tvId}/watch/providers?api_key=${API_KEY}`)
    ]);

    const series = await seriesRes.json();
    const providers = await providersRes.json();
    const defaultSeason = 1;
    const vidSrcUrl = `https://vidsrc.me/embed/tv?tmdb=${tvId}&season=${defaultSeason}&episode=1`;

    // âœ… Back button SVG
    const backButtonHTML = `
      <div class="back-button-tv" onclick="exitTo('tvPage')">
  <svg xmlns="http://www.w3.org/2000/svg" width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="15 18 9 12 15 6"></polyline>
  </svg>
</div>
    `;

    // âœ… Inject HTML
    watchContent.innerHTML = `
      ${backButtonHTML}

      <div class="video-container" style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 9999;
        background: black;">
        <iframe 
          src="${vidSrcUrl}" 
          frameborder="0" 
          allowfullscreen 
          style="width: 100%; aspect-ratio: 16/9; border-radius: 0;">
        </iframe>
      </div>

      <div class="series-info" style="padding-top: 10px; color: white;">
        <h2>${series.name}</h2>
        <p style="color: #ccc;">${series.overview || 'No description available.'}</p>

        <div class="series-meta" style="margin: 10px 0;">
          <span>â­ ${series.vote_average?.toFixed(1) || 'N/A'}/10</span>
          <span> â€¢ Seasons: ${series.number_of_seasons}</span>
          <span> â€¢ ${series.first_air_date?.split('-')[0] || 'N/A'}</span>

          ${
            providers.results?.US?.flatrate
              ? `<div class="providers" style="margin-top: 10px;">
                  Available on:
                  ${providers.results.US.flatrate.map(p => `
                    <img src="https://image.tmdb.org/t/p/w45${p.logo_path}" alt="${p.provider_name}" title="${p.provider_name}" />
                  `).join('')}
                </div>`
              : ''
          }
        </div>

        <div class="season-selector" style="margin-top: 20px;">
          <select id="seasonSelect">
            ${Array.from({ length: series.number_of_seasons }, (_, i) => `
              <option value="${i + 1}">Season ${i + 1}</option>
            `).join('')}
          </select>
          <button onclick="changeSeason(${tvId})">Load Episodes</button>
        </div>

        <div id="episodeList"></div>
      </div>
    `;

    // âœ… Load default season's episodes
    await changeSeason(tvId, defaultSeason);

    // âœ… Related shows
    try {
      const relatedRes = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/similar?api_key=${API_KEY}`);
      const relatedData = await relatedRes.json();
      const related = relatedData.results?.slice(0, 10) || [];

      if (related.length) {
        const relatedHTML = `
          <h3 style="margin-top: 32px; color: white;">Related Series</h3>
          <div class="related-tv-grid" style="display: flex; overflow-x: auto; gap: 12px;">
            ${related.map(show => `
              <div onclick="openTVSeries(${show.id})" style="min-width: 120px; cursor: pointer;">
                <img src="https://image.tmdb.org/t/p/w185${show.poster_path}" style="width: 100%; border-radius: 8px;" />
                <p style="color: #ccc; font-size: 12px; margin-top: 6px;">${show.name}</p>
              </div>
            `).join('')}
          </div>
        `;
        watchContent.insertAdjacentHTML('beforeend', relatedHTML);
      }
    } catch (err) {
      console.error("âŒ Failed to load related shows", err);
    }

  } catch (err) {
    console.error('âŒ Error loading TV series:', err);
    document.getElementById('watchContent').innerHTML = `
      <div class="error-message">
        <p>âš ï¸ Failed to load TV series. Try another one.</p>
        ${err.message.includes('Failed to fetch') ? `<small>This may be blocked in your region.</small>` : ''}
      </div>
    `;
  }
}

async function changeSeason(tvId, seasonNumber = null) {
  const selectedSeason = seasonNumber || document.getElementById('seasonSelect').value;
  const episodeList = document.getElementById('episodeList');

  try {
    const res = await fetch(`https://api.themoviedb.org/3/tv/${tvId}/season/${selectedSeason}?api_key=${API_KEY}`);
    const seasonData = await res.json();

    episodeList.innerHTML = `
      <h3>Season ${selectedSeason} Episodes</h3>
      <div class="episode-grid">
        ${seasonData.episodes.map(ep => `
          <div class="episode-card" onclick="loadTVEpisode(${tvId}, ${selectedSeason}, ${ep.episode_number})">
            <div class="episode-number">${ep.episode_number}</div>
            <img src="${ep.still_path ? `https://image.tmdb.org/t/p/w300${ep.still_path}` : 'placeholder.jpg'}" alt="${ep.name}" />
            <div class="episode-info">
              <h4>${ep.name}</h4>
              <p>${ep.overview?.slice(0, 100)}${ep.overview?.length > 100 ? '...' : ''}</p>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  } catch (err) {
    episodeList.innerHTML = `<p class="error">âŒ Failed to load episodes</p>`;
  }
}

function loadTVEpisode(tvId, season, episode) {
  const iframe = document.querySelector('.video-container iframe');
  if (iframe) {
    iframe.src = `https://vidsrc.me/embed/tv?tmdb=${tvId}&season=${season}&episode=${episode}`;
  }
}

async function openMovieModal(movie) {
  const modal = document.getElementById('movieModal');
  const iframe = document.getElementById('movieIframe');
  const title = document.getElementById('modalTitle');
  const overview = document.getElementById('modalOverview');
  const meta = document.getElementById('modalMeta');
  const reviewsContainer = document.getElementById('modalReviews');

}

//TVMovies
  const API_KEY = 'c9ae6d71a995e7c08499bd3a5c891052';
const BASE_URL = 'https://api.themoviedb.org/3';
const IMG_URL = 'https://image.tmdb.org/t/p/w500';

async function fetchMovies(endpoint) {
  const res = await fetch(`${BASE_URL}${endpoint}?api_key=${API_KEY}`);
  const data = await res.json();
  return data.results;
}

function renderMovieGrid(data, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  
  data.forEach(movie => {
    const div = document.createElement('div');
    div.className = 'movie-card';
    div.innerHTML = `
      <img src="${IMG_URL + movie.poster_path}" alt="${movie.title}" loading="lazy" />
      <div class="movie-overlay">
        <h4>${movie.title}</h4>
        <span>â­ ${movie.vote_average}</span>
      </div>
    `;

    // Add click handler to open in Watch tab
    div.addEventListener('click', () => openWatchPageWithContent(movie.id));
    
    container.appendChild(div);
  });
}


async function fetchTVShows(endpoint) {
  const url = `${BASE_URL}${endpoint}?api_key=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.results;
}

async function loadTVSections() {
  const popularTV = await fetchMovies('/tv/popular');
  const topRatedTV = await fetchMovies('/tv/top_rated');

  renderTVGrid(popularTV, 'popularTVGrid');
  renderTVGrid(topRatedTV, 'topRatedTVGrid');
}

function renderTVGrid(data, containerId) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  
  data.forEach(tv => {
    const div = document.createElement('div');
    div.className = 'movie-card'; // reuse same style
    div.innerHTML = `
      <img src="${IMG_URL + tv.poster_path}" alt="${tv.name}" loading="lazy" />
      <div class="movie-overlay">
        <h4>${tv.name}</h4>
        <span>â­ ${tv.vote_average}</span>
      </div>
    `;
    div.addEventListener('click', () => openTVSeries(tv.id));
    container.appendChild(div);
  });
}

async function loadMovieSections() {
  const trending = await fetchMovies('/trending/movie/week');
  const popular = await fetchMovies('/movie/popular');
  const topRated = await fetchMovies('/movie/top_rated');
  const upcoming = await fetchMovies('/movie/upcoming');
  

  renderMovieGrid(trending, 'trendingCarousel');
  renderMovieGrid(popular, 'popularGrid');
  renderMovieGrid(topRated, 'topRatedGrid');
  renderMovieGrid(upcoming, 'upcomingGrid');
}

document.addEventListener('DOMContentLoaded', loadMovieSections);
  loadTVSections(); // âœ… Add this line
</script>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchBar = document.getElementById('searchBarContainer');
    const navItems = document.querySelectorAll('.nav-item');

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const targetPage = item.getAttribute('data-page');

        // Show the search bar only on explorePage
        if (targetPage === 'explorePage') {
          searchBar.style.display = 'flex';
        } else {
          searchBar.style.display = 'none';
        }
      });
    });

    // Optional: trigger on initial load to match default active tab
    const activeItem = document.querySelector('.nav-item.active');
    if (activeItem) {
      const page = activeItem.getAttribute('data-page');
      searchBar.style.display = page === 'explorePage' ? 'flex' : 'none';
    }
  });
  
  <!-- mute toggle for ad video-->
  function toggleMute() {
    const video = document.getElementById("customAdVideo");
    const icon = document.getElementById("muteIcon");

    video.muted = !video.muted;
    icon.className = video.muted ? "fas fa-volume-mute" : "fas fa-volume-up";
  }
  
  
const playlist = [
  { 
    url: "https://ia601600.us.archive.org/12/items/red-sonja-official-trailer-hd-720p/Red_Sonja___Official_Trailer_HD%28720p%29.mp4",
    link: "#"
  },
  { 
    url: "https://ia801704.us.archive.org/4/items/avatar-fire-and-ash-official-trailer-480p/Avatar__Fire_and_Ash___Official_Trailer%28480p%29.mp4",
    link: "#" 
  },
  {
  url: "https://ia801704.us.archive.org/4/items/avatar-fire-and-ash-official-trailer-480p/Avatar__Fire_and_Ash___Official_Trailer%28480p%29.mp4",
    link: "#" 
  }
];

let front = document.getElementById("vidA");
let back = document.getElementById("vidB");
let videoLink = document.getElementById("videoLink");
let currentIndex = 0;
let isMuted = false; // Track mute state globally

// Improved play function with sound handling
function playVideo(index) {
  // Reset both videos
  front.style.opacity = "1";
  back.style.opacity = "0";
  
  front.src = playlist[index].url;
  videoLink.href = playlist[index].link;
  
  // Apply current mute state
  front.muted = isMuted;
  back.muted = isMuted;
  
  // Try playing with sound
  front.play().catch(e => {
    console.log("Autoplay blocked:", e);
    // Fallback: mute and try again
    front.muted = true;
    isMuted = true;
    document.getElementById("muteIcon").className = "fas fa-volume-mute";
    front.play();
  });
}

// Proper crossfade transition
front.addEventListener("ended", () => {
  currentIndex = (currentIndex + 1) % playlist.length;
  
  // Prepare next video
  back.src = playlist[currentIndex].url;
  videoLink.href = playlist[currentIndex].link;
  back.muted = isMuted;
  
  // Crossfade transition
  back.style.opacity = "1";
  front.style.opacity = "0";
  
  // Play the new visible video
  back.play().catch(e => {
    console.log("Transition play failed:", e);
    back.muted = true;
    back.play();
  });
  
  // Swap roles
  [front, back] = [back, front];
});

// Working mute toggle
function toggleMute() {
  isMuted = !isMuted;
  front.muted = isMuted;
  back.muted = isMuted;
  
  // Update icon
  document.getElementById("muteIcon").className = 
    isMuted ? "fas fa-volume-mute" : "fas fa-volume-up";
}

// Initialize first video
playVideo(0);
function toggleMute() {
  const isMuted = front.muted;
  front.muted = !isMuted;
  back.muted = !isMuted;
  
  const icon = document.getElementById("muteIcon");
  icon.className = isMuted ? "fas fa-volume-up" : "fas fa-volume-mute";
}

// Initialize
playVideo(0);
</script>

<script>
  const video = document.getElementById("customAdVideo");

  document.addEventListener("visibilitychange", function () {
    if (document.visibilityState === "visible") {
      if (video && video.readyState >= 2) {
        video.currentTime = 0;
        video.play().catch(() => {
          video.muted = true;
          video.play();
        });
      }
    }
  });
 
</script>

<!-- Default Statcounter code for TubeTrailer
http://tubetrailerweb.vercel.app -->
<script type="text/javascript">
var sc_project=13118904; 
var sc_invisible=1; 
var sc_security="0bf9b7d3"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/13118904/0/0bf9b7d3/1/"
alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->

<!-- Makes home button reload-->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const homeBtn = document.getElementById("homeBtn");
  const searchResults = document.getElementById("searchResults");
  const exploreContent = document.getElementById("exploreContent");
  const searchInput = document.getElementById("search");

  homeBtn.addEventListener("click", function () {
    // Hide search results
    if (searchResults) searchResults.style.display = "none";

    // Show full explore section (including trailers, movies, etc.)
    if (exploreContent) exploreContent.style.display = "block";

    // Clear the search input
    if (searchInput) searchInput.value = "";

    // Optional: scroll to top of explore
    exploreContent.scrollIntoView({ behavior: "smooth" });
  });
});
</script>
<script>
     //Hides the Player Tab
document.addEventListener('DOMContentLoaded', () => {
  const playerTab = document.querySelector('.nav-item[data-page="playerPage"]');
  if (playerTab) {
    playerTab.style.display = 'none';
  } else {
    console.warn('Player tab not found');
  }
});

//Animates the Back Arrow to display 
document.addEventListener('DOMContentLoaded', () => {
  const backArrow = document.getElementById('backToExplore');
  let hideTimer;

  function hideArrow() {
    backArrow.classList.add('hidden');
  }

  function showArrow() {
    backArrow.classList.remove('hidden');
    restartHideTimer();
  }

  function restartHideTimer() {
    clearTimeout(hideTimer);
    hideTimer = setTimeout(hideArrow, 5000);
  }

  // Start hide timer when player page loads
  restartHideTimer();

  // Show again on any click or tap
  document.addEventListener('click', showArrow);
  document.addEventListener('touchstart', showArrow);
});

//Makes the Back Arrow Return to explore tab
document.addEventListener('DOMContentLoaded', () => {
  const backArrow = document.getElementById('backToExplore');

  // Already includes fade logic, so just add this:
  backArrow?.addEventListener('click', () => {
    switchTab('explorePage');
  });
});

async function openWatchPageWithContent(id, type = "movie") {

const PROXY_URL = 'https://d1-templatevideo.winnerukoh.workers.dev/';

 // Function to create proxy URLs
  function createProxyUrl(originalUrl) {
      return `${PROXY_URL}?url=${encodeURIComponent(originalUrl)}`;
  }
  
  switchTab("watchPage");

  // Hide the placeholder
  const placeholder = document.getElementById("watchPlaceholder");
  const content = document.getElementById("watchContent");

  if (placeholder) placeholder.style.display = "none";
  if (content) content.style.display = "block";

 // Create the proxy URL for the video
  const videoUrl = `https://vidsrc.to/embed/${type}/${id}`;
  const proxyVideoUrl = createProxyUrl(videoUrl);
  
  // Initial content structure with ad overlay
  content.innerHTML = `
    <div class="back-button" onclick="switchTab('tvPage')">
      <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="#fff" viewBox="0 0 24 24">
        <path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path>
      </svg>
    </div>

    <!-- Ad Overlay (shown first) -->
    <div id="adOverlay" style="
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #111;
      z-index: 9998;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      align-items: center;
      color: white;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    ">
      <h3 style="margin: 0;">Advertisement</h3>
      
      <!-- Ad Container -->
      <div id="adContainer" style="
        width: 100%;
        max-width: 728px;
        height: 90%;
        min-height: 250px;
        margin: 0 auto;
        background: rgba(255,255,255,0.05);
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
      ">
        <!-- Loading spinner while image loads -->
        <div class="spinner" style="width: 40px; height: 40px;"></div>
      </div>

      <button id="skipAdBtn" style="
        padding: 10px 24px;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: bold;
        margin-top: 15px;
      ">
        Skip Ad (5)
      </button>
    </div>

    <!-- Actual video container (hidden initially) -->
    <div id="mainContent" style="display: none;">
      <div id="videoContainer">
        <iframe src="${proxyVideoUrl}" 
            frameborder="0" allowfullscreen
            style="width: 100%; height: 250px; border-radius: 8px;">
        </iframe>
        <div class="video-helper-note">
          <span class="helper-text show">âš ï¸If video doesn't load, try again later.</span>
          <span class="helper-text">Ads may open in new tab â€” return to continue watching.</span>
        </div>
      </div>

      <div class="videoContentWrapper">
        <div class="spinner"></div>
      </div>
    </div>
  `;

  // Image ads configuration
  // In your openWatchPageWithContent function, replace the ads and displayAdImage section with:

// Image ads configuration - now using smaller placeholder images
// Image ads configuration
const ads = [
  {
    imageUrl: "https://i.ibb.co/Mk2tGS8b/0c8ee428bc779263160e3c071e1a741e.jpg",
    redirectUrl: "https://pubertytechnicallyknowhow.com/gywrbezxbn?key=4e6421e6b6a6cff6634135ddd92498d6",
    storageKey: "adImage1"
  },
  {
    imageUrl: "https://i.ibb.co/MDkGvggn/e72a5a7d-3f74-4ea9-9720-2fae079704ee.jpg",
    redirectUrl: "https://pubertytechnicallyknowhow.com/gywrbezxbn?key=4e6421e6b6a6cff6634135ddd92498d6",
    storageKey: "adImage2"
  }
  
];

// Get current ad index
let currentAdIndex = parseInt(localStorage.getItem('currentAdIndex')) || 0;
currentAdIndex = (currentAdIndex + 1) % ads.length;
localStorage.setItem('currentAdIndex', currentAdIndex);
const currentAd = ads[currentAdIndex];

// Immediately create and display the ad link
const adContainer = document.getElementById('adContainer');
const tempImg = new Image();
tempImg.src = currentAd.imageUrl;
tempImg.style.maxWidth = "100%";
tempImg.style.maxHeight = "100%";
tempImg.style.objectFit = "contain";

const adLink = document.createElement('a');
adLink.href = currentAd.redirectUrl;
adLink.target = "_blank";
adLink.rel = "noopener noreferrer";
adLink.style.display = "flex";
adLink.style.justifyContent = "center";
adLink.style.alignItems = "center";
adLink.style.width = "100%";
adLink.style.height = "100%";
adLink.appendChild(tempImg);

// Clear any existing content and append new ad
adContainer.innerHTML = '';
adContainer.appendChild(adLink);

// Try to cache the image without blocking UI
try {
  if (!localStorage.getItem(currentAd.storageKey)) {
    fetch(currentAd.imageUrl)
      .then(response => response.blob())
      .then(blob => {
        if (blob.size < 1000000) { // Only cache if < 1MB
          const reader = new FileReader();
          reader.onloadend = () => {
            try {
              localStorage.setItem(currentAd.storageKey, reader.result);
            } catch (e) {
              console.log("Couldn't cache image (quota exceeded)");
              // Clear old cached items if quota is exceeded
              Object.keys(localStorage).forEach(key => {
                if (key.startsWith('adImage')) {
                  localStorage.removeItem(key);
                }
              });
            }
          };
          reader.readAsDataURL(blob);
        }
      })
      .catch(console.error);
  }
} catch (e) {
  console.log("LocalStorage not available for caching");
}

// Countdown timer for skip button
let countdown = 5;
const skipBtn = document.getElementById("skipAdBtn");
const countdownInterval = setInterval(() => {
  countdown--;
  skipBtn.textContent = `Skip Ad (${countdown})`;
  if (countdown <= 0) {
    clearInterval(countdownInterval);
    skipBtn.textContent = "Continue to Video";
    skipBtn.disabled = false;
  }
}, 1000);

// Function to show main content
const showMainContent = () => {
  clearInterval(countdownInterval);
  document.getElementById("adOverlay").style.display = "none";
  document.getElementById("mainContent").style.display = "block";
  startHelperTextFade();
};

// Skip button functionality
skipBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  if (countdown <= 0) {
    showMainContent();
  }
});

// Auto-continue after 10 seconds if user doesn't skip
setTimeout(showMainContent, 10000);

// Fetch movie/TV data
const API_KEY = 'c9ae6d71a995e7c08499bd3a5c891052';
const BASE_URL = 'https://api.themoviedb.org/3';

try {
  const res = await fetch(`${BASE_URL}/${type}/${id}?api_key=${API_KEY}&append_to_response=credits,reviews,similar`);
  const data = await res.json();

  const title = data.title || data.name || "Untitled";
  const release_date = data.release_date || data.first_air_date || "";
  const year = release_date ? release_date.split("-")[0] : "";
  const overview = data.overview || "No description available.";
  const genres = data.genres?.map(g => g.name).join(", ") || "Unknown Genre";

  const wrapper = document.querySelector(".videoContentWrapper");
  wrapper.innerHTML = `
    <h2 style="margin-top: 24px; color: white;">${title} <span style="font-size: 15px; color: #bbb;">(${year} â€¢ ${genres})</span></h2>
    <div style="background: #2a2a2a; color: white; padding: 16px; border-radius: 8px;">${overview}</div>
  `;

    // Cast section
    const cast = data.credits?.cast?.slice(0, 12) || [];
    if (cast.length) {
      const castHTML = `
        <h3 style="margin-top: 24px; color: white;">Cast</h3>
        <div style="display: flex; overflow-x: auto; gap: 12px;">
          ${cast.map(actor => actor.profile_path ? `
            <div style="text-align: center; min-width: 80px;">
              <img src="https://image.tmdb.org/t/p/w185${actor.profile_path}" 
                   style="width: 72px; height: 72px; border-radius: 50%;" />
              <p style="color: white; font-size: 12px; margin-top: 4px;">${actor.name}</p>
            </div>` : '').join('')}
        </div>
      `;
      wrapper.insertAdjacentHTML('beforeend', castHTML);
    }

    // Reviews section
    if (data.reviews?.results?.length) {
      const reviews = data.reviews.results.slice(0, 3);
      let reviewHTML = `
        <div class="review-section">
          <h3 class="section-title">Top Reviews</h3>
      `;

      reviews.forEach(review => {
        reviewHTML += `
          <div class="review-box">
            <p class="review-author">ðŸ—£ ${review.author}</p>
            <p class="review-content">${review.content}</p>
          </div>
        `;
      });

      reviewHTML += `</div>`;
      wrapper.insertAdjacentHTML('beforeend', reviewHTML);
    }

    // Related content
    const related = data.similar?.results?.slice(0, 10) || [];
    if (related.length) {
      const relatedHTML = `
        <h3 style="margin-top: 24px; color: white;">Related ${type === 'tv' ? 'Series' : 'Movies'}</h3>
        <div style="display: flex; overflow-x: auto; gap: 12px;">
          ${related.map(rel => rel.poster_path ? `
            <div style="min-width: 120px;" onclick="openWatchPageWithContent(${rel.id}, '${type}')">
              <img src="https://image.tmdb.org/t/p/w185${rel.poster_path}" 
                   style="width: 100%; border-radius: 8px;" />
              <p style="color: white; font-size: 12px;">${rel.title || rel.name}</p>
            </div>` : '').join('')}
        </div>
      `;
      wrapper.insertAdjacentHTML('beforeend', relatedHTML);
    }

  } catch (err) {
    console.error("Error loading video:", err);
    const wrapper = document.querySelector(".videoContentWrapper");
    wrapper.innerHTML = `<p style="color:red;">Failed to load content. Please try again.</p>`;
  }
}

function startHelperTextFade() {
  // Hide helper note after 15s
  setTimeout(() => {
    const note = document.querySelector('.video-helper-note');
    if (note) note.style.display = 'none';
  }, 15000);

  // Text rotation logic
  let current = 0;
  const texts = document.querySelectorAll('.helper-text');
  const fadeInterval = setInterval(() => {
    if (!texts.length || current >= 2) return;
    texts.forEach(t => t.classList.remove('show'));
    current = (current + 1) % texts.length;
    texts[current].classList.add('show');
  }, 3000);

  // Stop rotation after 20s
  setTimeout(() => clearInterval(fadeInterval), 20000);
}


    // IMA3 Ad Player Integration
    (function() {
        // Initialize variables
        let adsLoader, adsManager;
        let adDisplayContainer;
        let adPlaying = false;
        let adCount = 0;
        
        // Get elements
        const adContainer = document.getElementById('ad-container');
        const statusDisplay = document.getElementById('status');
        
        // Debug logging
        function logDebug(message) {
            console.log(message);
            statusDisplay.textContent = message.length > 50 ? message.substring(0, 50) + "..." : message;
        }
        
        // Set up IMA
        function setUpIMA() {
            logDebug("Setting up IMA...");
            
            // Create Ad Display Container
            adDisplayContainer = new google.ima.AdDisplayContainer(adContainer);
            
            // Create Ads Loader
            adsLoader = new google.ima.AdsLoader(adDisplayContainer);
            
            // Listen for ads manager load event
            adsLoader.addEventListener(
                google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,
                onAdsManagerLoaded);
            
            // Listen for ad errors
            adsLoader.addEventListener(
                google.ima.AdErrorEvent.Type.AD_ERROR,
                onAdError);
            
            // Listen for when all ads are finished
            adsLoader.addEventListener(
                google.ima.AdEvent.Type.ALL_ADS_COMPLETED,
                onAllAdsCompleted);
            
            // Initialize and start
            try {
                adDisplayContainer.initialize();
                logDebug("Ad display initialized");
                requestAds();
            } catch (error) {
                logDebug("Error initializing: " + error);
            }
        }
        
        // Request ads
        function requestAds() {
            logDebug("Requesting ads...");
            
            // Create ads request
            const adsRequest = new google.ima.AdsRequest();
            adsRequest.adTagUrl = "https://sophisticated-check.com/d/mqFWz.dVGdN/viZFG/Uw/Ge/m/9fuYZbU/l/kHPrTeYm2hMsznMi4DM/T/UUtCNPjsYTzzMtzlg/xcNzinZjsjaiWD1mpvdkDh0/xP";
            
            // Specify the linear and nonlinear slot sizes
            adsRequest.linearAdSlotWidth = adContainer.clientWidth;
            adsRequest.linearAdSlotHeight = adContainer.clientHeight;
            adsRequest.nonLinearAdSlotWidth = adContainer.clientWidth;
            adsRequest.nonLinearAdSlotHeight = 150;
            
            // Request ads
            adsLoader.requestAds(adsRequest);
        }
        
        // When ads manager is loaded
        function onAdsManagerLoaded(event) {
            logDebug("Ads manager loaded");
            
            // Get the ads manager
            adsManager = event.getAdsManager();
            
            // Add listeners to the ads manager
            adsManager.addEventListener(
                google.ima.AdErrorEvent.Type.AD_ERROR,
                onAdError);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,
                onContentPauseRequested);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,
                onContentResumeRequested);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.ALL_ADS_COMPLETED,
                onAllAdsCompleted);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.LOADED,
                onAdLoaded);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.STARTED,
                onAdStarted);
            
            adsManager.addEventListener(
                google.ima.AdEvent.Type.COMPLETE,
                onAdComplete);
            
            // Initialize the ads manager with current window size
            try {
                adsManager.init(adContainer.clientWidth, adContainer.clientHeight, google.ima.ViewMode.NORMAL);
            } catch (adError) {
                onAdError(adError);
            }
        }
        
        // Handle ad loaded
        function onAdLoaded() {
            logDebug("Ad loaded");
            try {
                adsManager.start();
            } catch (adError) {
                onAdError(adError);
            }
        }
        
        // Handle ad started
        function onAdStarted() {
            adPlaying = true;
            adCount++;
            logDebug("Ad " + adCount + " playing");
        }
        
        // Handle ad complete
        function onAdComplete() {
            adPlaying = false;
            logDebug("Ad completed");
        }
        
        // Handle content pause requested
        function onContentPauseRequested() {
            logDebug("Ad playing");
        }
        
        // Handle content resume requested
        function onContentResumeRequested() {
            // After an ad completes, request the next one
            setTimeout(requestAds, 1000);
        }
        
        // Handle all ads completed
        function onAllAdsCompleted() {
            adPlaying = false;
            // Request the next ad
            setTimeout(requestAds, 1000);
        }
        
        // Handle ad errors
        function onAdError(error) {
            console.error('Ad error:', error);
            const errorMsg = error instanceof Object ? error.getError() : error;
            logDebug("Ad error, retrying...");
            
            // Request the next ad after an error
            setTimeout(requestAds, 2000);
        }
        
        // Handle window resize to maintain proper ad dimensions
        window.addEventListener('resize', function() {
            if (adsManager) {
                adsManager.resize(adContainer.clientWidth, adContainer.clientHeight, google.ima.ViewMode.NORMAL);
            }
        });
        
        // Initialize IMA when Google IMA script is loaded
        function checkIMALoaded() {
            if (typeof google !== 'undefined' && google.ima) {
                logDebug("IMA SDK loaded");
                setUpIMA();
            } else {
                setTimeout(checkIMALoaded, 100);
            }
        }
        
        // Start checking for IMA SDK
        checkIMALoaded();
        
    })();

</script>
</body>
</html>
